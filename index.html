<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IRS Notice Analyzer | Thomas Tax Strategists</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .step {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .upload-zone {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 60px 40px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 30px 0;
        }

        .upload-zone:hover {
            border-color: #764ba2;
            background: #e8f4f8;
        }

        .upload-zone.dragover {
            border-color: #28a745;
            background: #d4edda;
        }

        .upload-icon {
            font-size: 4em;
            color: #667eea;
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .info-card {
            background: #e8f4f8;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #2a5298;
        }

        .alert-box {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ff9800;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .notice-result {
            background: white;
            border: 2px solid #667eea;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }

        .notice-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .notice-type {
            font-size: 2em;
            font-weight: bold;
            color: #1e3c72;
        }

        .urgency-badge {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .urgency-low {
            background: #d4edda;
            color: #155724;
        }

        .urgency-medium {
            background: #fff3cd;
            color: #856404;
        }

        .urgency-high {
            background: #f8d7da;
            color: #721c24;
        }

        .urgency-critical {
            background: #721c24;
            color: white;
        }

        .question-box {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .question {
            font-size: 1.2em;
            font-weight: 600;
            color: #1e3c72;
            margin-bottom: 15px;
        }

        .radio-option, .checkbox-option {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .radio-option:hover, .checkbox-option:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .radio-option.selected, .checkbox-option.selected {
            border-color: #667eea;
            background: #e8f4f8;
        }

        .radio-option input[type="radio"],
        .checkbox-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .text-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            margin: 10px 0;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .timeline {
            margin: 20px 0;
            padding: 20px 0;
        }

        .timeline-item {
            padding: 15px 15px 15px 25px;
            border-left: 3px solid #667eea;
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .timeline-item h4 {
            color: #1e3c72;
            margin-bottom: 8px;
        }

        .template-box {
            background: #f8f9fa;
            border: 2px solid #667eea;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            line-height: 1.8;
            margin: 15px 0;
        }

        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            max-width: 100%;
            background: #000;
            border-radius: 10px;
            margin: 20px 0;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .print-checklist,
        #printChecklist {
            display: none;
        }

        @media print {
            /* Force white background */
            body {
                background: white !important;
                padding: 0 !important;
            }

            /* Hide EVERYTHING initially */
            body > *:not(#printChecklist) {
                display: none !important;
            }

            /* Show ONLY the print checklist */
            body > #printChecklist,
            #printChecklist {
                display: block !important;
                position: static !important;
                page-break-before: auto !important;
                visibility: visible !important;
                opacity: 1 !important;
            }

            /* Ensure checkboxes are visible */
            #printChecklist input[type="checkbox"] {
                -webkit-appearance: checkbox !important;
                -moz-appearance: checkbox !important;
                appearance: checkbox !important;
                display: inline-block !important;
                width: 15px !important;
                height: 15px !important;
                border: 2px solid #333 !important;
                margin-right: 10px !important;
            }

            /* Preserve colors and backgrounds */
            #printChecklist,
            #printChecklist * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }

            /* Ensure page breaks work properly */
            #printChecklist h2, #printChecklist h3 {
                page-break-after: avoid !important;
            }

            /* Don't break inside sections */
            #printChecklist div[style*="page-break-inside"] {
                page-break-inside: avoid !important;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.6em;
            }
            
            .main-content {
                padding: 20px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .notice-header {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìÑ IRS Notice Analyzer</h1>
            <p>Upload your IRS letter ‚Ä¢ Get instant analysis ‚Ä¢ Know your next steps</p>
        </div>

        <div class="main-content">
            <!-- Step 1: Upload -->
            <div class="step active" id="step1">
                <h2 style="color: #1e3c72; margin-bottom: 20px;">Step 1: Upload Your IRS Notice</h2>
                
                <div class="info-card">
                    <h3 style="margin-bottom: 10px;">üìã What We'll Tell You</h3>
                    <p>Upload a clear photo or PDF of your IRS notice. We'll analyze it and tell you:</p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>What type of notice you received</li>
                        <li>What the IRS wants from you</li>
                        <li>Your deadline (if any)</li>
                        <li>Exactly how to resolve it step-by-step</li>
                        <li>Which tools and templates to use</li>
                    </ul>
                </div>

                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">üì§</div>
                    <h3>Drag & Drop Your IRS Notice Here</h3>
                    <p style="margin: 15px 0;">or click to browse</p>
                    <p style="font-size: 0.9em; color: #666;">Accepts: PDF, JPG, PNG (Max 10MB)</p>
                    <input type="file" id="fileInput" class="file-input" accept=".pdf,.jpg,.jpeg,.png">
                </div>

                <div id="filePreview" style="display: none; margin: 20px 0;">
                    <div class="success-box">
                        <h3>‚úì File Uploaded Successfully</h3>
                        <p id="fileName"></p>
                    </div>
                </div>

                <div class="warning-box">
                    <h4 style="margin-bottom: 10px;">üîí Your Privacy Matters</h4>
                    <p>We analyze your notice to provide guidance. Your document is processed securely and not stored on our servers.</p>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" id="analyzeBtn" disabled>Analyze My Notice</button>
                </div>
            </div>

            <!-- Step 2: Manual Input (if can't detect) -->
            <div class="step" id="step2">
                <h2 style="color: #1e3c72; margin-bottom: 20px;">Help Us Identify Your Notice</h2>
                
                <div class="info-card">
                    <p>We couldn't automatically detect your notice type. Please help us by answering these questions:</p>
                </div>

                <div class="question-box">
                    <div class="question">What is the notice number on your letter?</div>
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 15px;">Look in the top right corner for something like "CP14" or "Letter 1058"</p>
                    <input type="text" id="noticeNumber" class="text-input" placeholder="Example: CP14, CP2000, LT11, etc.">
                </div>

                <div class="question-box">
                    <div class="question">What is this notice about?</div>
                    <div class="radio-option" onclick="selectRadio(this, 'balance-due')">
                        <input type="radio" name="noticeType" value="balance-due">
                        <label>You owe money / Balance due</label>
                    </div>
                    <div class="radio-option" onclick="selectRadio(this, 'changes')">
                        <input type="radio" name="noticeType" value="changes">
                        <label>IRS made changes to your return</label>
                    </div>
                    <div class="radio-option" onclick="selectRadio(this, 'levy')">
                        <input type="radio" name="noticeType" value="levy">
                        <label>Intent to levy / Seize assets</label>
                    </div>
                    <div class="radio-option" onclick="selectRadio(this, 'payment-plan')">
                        <input type="radio" name="noticeType" value="payment-plan">
                        <label>Payment plan issue / Default notice</label>
                    </div>
                    <div class="radio-option" onclick="selectRadio(this, 'review')">
                        <input type="radio" name="noticeType" value="review">
                        <label>Return under review / Need information</label>
                    </div>
                    <div class="radio-option" onclick="selectRadio(this, 'other')">
                        <input type="radio" name="noticeType" value="other">
                        <label>Something else / Not sure</label>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="goToStep(1)">Back</button>
                    <button class="btn btn-primary" onclick="processManualInput()">Continue</button>
                </div>
            </div>

            <!-- Step 3: Loading -->
            <div class="step" id="step3">
                <div class="loading">
                    <div class="spinner"></div>
                    <h3 style="color: #1e3c72;">Analyzing Your Notice...</h3>
                    <p style="margin-top: 10px; color: #666;">This will take just a moment</p>
                </div>
            </div>

            <!-- Step 4: Results -->
            <div class="step" id="step4">
                <h2 style="color: #1e3c72; margin-bottom: 20px;">Your Notice Analysis</h2>
                
                <div class="notice-result">
                    <div class="notice-header">
                        <div class="notice-type" id="noticeType"></div>
                        <div class="urgency-badge" id="urgencyBadge"></div>
                    </div>

                    <div style="margin: 20px 0;">
                        <h3 style="color: #1e3c72; margin-bottom: 10px;">What This Notice Means:</h3>
                        <p id="noticeMeaning" style="font-size: 1.1em; line-height: 1.6;"></p>
                    </div>

                    <div style="margin: 20px 0;">
                        <h3 style="color: #1e3c72; margin-bottom: 10px;">Why You Received It:</h3>
                        <p id="noticeReason" style="line-height: 1.6;"></p>
                    </div>

                    <div id="deadlineSection" style="margin: 20px 0; display: none;">
                        <div class="alert-box">
                            <h3 style="margin-bottom: 10px;">‚è∞ Important Deadline</h3>
                            <p id="deadlineText"></p>
                        </div>
                    </div>
                </div>

                <div id="followUpQuestions" style="display: none;">
                    <h3 style="color: #1e3c72; margin: 30px 0 20px 0;">Let's Get More Details</h3>
                    <p style="margin-bottom: 20px; color: #666;">Answer a few more questions so we can provide the most specific guidance:</p>
                    <div id="questionsContainer"></div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="goToStep(1)" style="margin-right: 10px;">‚Üê Start Over</button>
                    <button class="btn btn-primary" id="showResourcesBtn" onclick="showResources()">Show Me How to Fix This</button>
                </div>
            </div>

            <!-- Step 5: Recommended Resources -->
            <div class="step" id="step5">
                <h2 style="color: #1e3c72; margin-bottom: 20px;">Your Step-by-Step Action Plan</h2>
                
                <div class="success-box">
                    <h3 style="margin-bottom: 10px;">‚úì Here's Exactly How to Resolve This</h3>
                    <p>Based on your situation, follow these instructions in order:</p>
                </div>

                <div id="resourcesContainer"></div>

                <div id="professionalHelpSection" style="display: none; margin-top: 30px;">
                    <div class="alert-box">
                        <h3 style="margin-bottom: 15px;">‚ö†Ô∏è Consider Professional Help</h3>
                        <p id="professionalHelpReason" style="margin-bottom: 15px;"></p>
                        <button class="btn btn-primary" onclick="window.open('https://calendly.com/shontathomas/60-min-strategy-call', '_blank')">
                            Schedule Strategy Call
                        </button>
                    </div>
                </div>

                <div class="action-buttons" style="margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="goToStep(4)" style="margin-right: 10px;">‚Üê Back to Analysis</button>
                    <button class="btn btn-secondary" onclick="location.reload()">Analyze Another Notice</button>
                </div>
                
                <!-- Download Action Plan - at very bottom -->
                <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e0e0e0; text-align: center;">
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 10px;">Save your personalized action plan</p>
                    <button class="btn btn-primary" onclick="downloadActionPlan()" style="font-size: 1.1em; padding: 15px 40px;">üì• Download My Action Plan</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let uploadedFile = null;
        let noticeData = {};
        let followUpAnswers = {};

        // ============================================
        // PENALTY CALCULATION FUNCTION
        // ============================================
        function calculatePenaltySavings(answers) {
            if (!answers.hasBalancePenalties || answers.hasBalancePenalties !== 'yes') {
                return { ftf: 0, ftp: 0, other: 0, total: 0 };
            }
            
            // First check if exact penalty amounts are in answers (from penaltyAmount inputs)
            const ftfFromAnswers = parseFloat(answers.penaltyFTF) || 0;
            const ftpFromAnswers = parseFloat(answers.penaltyFTP) || 0;
            const otherFromAnswers = parseFloat(answers.penaltyOther) || 0;
            
            // If we have numeric values in answers, use those
            if (ftfFromAnswers > 0 || ftpFromAnswers > 0 || otherFromAnswers > 0) {
                return {
                    ftf: ftfFromAnswers,
                    ftp: ftpFromAnswers,
                    other: otherFromAnswers,
                    total: ftfFromAnswers + ftpFromAnswers + otherFromAnswers
                };
            }
            
            // Also check window.exactPenalties as backup
            if (window.exactPenalties && Object.keys(window.exactPenalties).length > 0) {
                const ftf = window.exactPenalties.penaltyFTF || 0;
                const ftp = window.exactPenalties.penaltyFTP || 0;
                const other = window.exactPenalties.penaltyOther || 0;
                
                if (ftf > 0 || ftp > 0 || other > 0) {
                    return {
                        ftf: ftf,
                        ftp: ftp,
                        other: other,
                        total: ftf + ftp + other
                    };
                }
            }
            
            // Fallback to range estimates (legacy support - should rarely be used now)
            const rangeMap = {
                '$0': 0,
                'Under $500': 250,
                '$500 - $1,000': 750,
                '$1,000 - $2,500': 1750,
                '$2,500 - $5,000': 3750,
                'Over $5,000': 6000
            };
            
            const ftf = rangeMap[answers.penaltyFTF] || 0;
            const ftp = rangeMap[answers.penaltyFTP] || 0;
            const other = rangeMap[answers.penaltyOther] || 0;
            
            return {
                ftf: ftf,
                ftp: ftp,
                other: other,
                total: ftf + ftp + other
            };
        }

        // ============================================
        // PAYMENT COMPARISON CALCULATOR
        // ============================================
        function showPaymentComparison(container, answers) {
            const savings = calculatePenaltySavings(answers);
            
            // If no penalties entered (all zeros), skip comparison and go straight to resources
            // But only if user explicitly has $0 in penalties
            if (savings.total === 0 && answers.hasBalancePenalties !== 'yes') {
                showResources();
                return;
            }
            
            // Use exact balance if available, otherwise estimate from ranges
            let totalBalance;
            if (answers.exactBalance && answers.exactBalance > 0) {
                totalBalance = answers.exactBalance;
            } else {
                const balanceRanges = {
                    'Under $1,000': 750,
                    '$1,000 - $5,000': 3000,
                    '$5,000 - $15,000': 10000,
                    'Over $15,000': 20000,
                    'Under $10,000': 7500,
                    '$10,000 - $15,000': 12500,
                    '$15,000 - $25,000': 20000,
                    'Over $25,000': 30000
                };
                totalBalance = balanceRanges[answers.amount] || 10000;
            }
            
            // Store penalty savings for later screens
            window.penaltySavingsAmount = savings.total;
            window.totalBalanceAmount = totalBalance;
            
            const resourcesContainer = document.getElementById('resourcesContainer');
            
            resourcesContainer.innerHTML = `
                <div style="padding: 20px;">
                    <h2 style="text-align: center; color: #1e3c72; margin-bottom: 30px; font-size: 1.8em;">
                        üí∞ See How Penalty Abatement Saves You Money
                    </h2>
                    
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                        <p style="text-align: center; color: #666; margin-bottom: 20px;">
                            Your balance: <strong>$${totalBalance.toLocaleString()}</strong> | 
                            Your penalties: <strong>$${savings.total.toLocaleString()}</strong>
                        </p>
                        
                        <div style="text-align: center; margin-bottom: 15px;">
                            <label style="font-weight: bold; color: #1e3c72; margin-right: 15px;">Choose payment term:</label>
                            <select id="termSelector" onchange="updatePaymentComparison()" style="padding: 12px 20px; font-size: 1.1em; border: 2px solid #667eea; border-radius: 8px; cursor: pointer;">
                                <option value="36">3 years (36 months)</option>
                                <option value="48">4 years (48 months)</option>
                                <option value="60">5 years (60 months)</option>
                                <option value="72" selected>6 years (72 months)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="comparisonCards" style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 40px;">
                        <!-- Cards will be populated by updatePaymentComparison() -->
                    </div>
                    
                    <style>
                        @media (max-width: 600px) {
                            #comparisonCards {
                                grid-template-columns: 1fr !important;
                            }
                        }
                    </style>
                    
                    <div style="text-align: center;">
                        <button onclick="showPenaltyDecisionScreen()" class="btn btn-primary" style="padding: 18px 45px; font-size: 1.2em;">
                            Continue ‚Üí
                        </button>
                    </div>
                </div>
            `;
            
            // Initial calculation
            updatePaymentComparison();
            
            window.scrollTo(0, 0);
        }
        
        function updatePaymentComparison() {
            const termSelector = document.getElementById('termSelector');
            const months = parseInt(termSelector.value);
            const years = months / 12;
            
            const totalBalance = window.totalBalanceAmount;
            const penaltySavings = window.penaltySavingsAmount;
            const balanceWithoutPenalties = Math.max(0, totalBalance - penaltySavings);
            
            // Calculate with 8% annual interest
            const interestRate = 0.08;
            
            // Simple interest approximation (accounts for declining balance)
            const interestWith = totalBalance * interestRate * years * 0.55;
            const interestWithout = balanceWithoutPenalties * interestRate * years * 0.55;
            
            const totalPaidWith = Math.ceil(totalBalance + interestWith);
            const totalPaidWithout = Math.ceil(balanceWithoutPenalties + interestWithout);
            
            const monthlyWith = Math.ceil(totalPaidWith / months);
            const monthlyWithout = Math.ceil(totalPaidWithout / months);
            
            const totalSavings = totalPaidWith - totalPaidWithout;
            
            // Store for later use
            window.comparisonData = {
                totalBalance,
                balanceWithoutPenalties,
                totalPaidWith,
                totalPaidWithout,
                monthlyWith,
                monthlyWithout,
                totalSavings,
                penaltySavings: penaltySavings,
                months: months
            };
            
            const cardsContainer = document.getElementById('comparisonCards');
            cardsContainer.innerHTML = `
                <!-- WITH PENALTIES -->
                <div style="background: #fff3cd; border: 3px solid #ff9800; border-radius: 15px; padding: 25px; text-align: center;">
                    <div style="background: #ff9800; color: white; padding: 10px; border-radius: 10px; margin: -25px -25px 20px -25px;">
                        <strong>WITH Penalties</strong>
                    </div>
                    <p style="color: #856404; font-size: 0.95em; margin-bottom: 10px;">Starting balance: $${totalBalance.toLocaleString()}</p>
                    <div style="font-size: 2.4em; font-weight: bold; color: #ff9800; margin: 10px 0;">
                        $${monthlyWith.toLocaleString()}/mo
                    </div>
                    <p style="color: #856404; font-size: 1em; margin-top: 15px;">
                        Total paid: <strong>$${totalPaidWith.toLocaleString()}</strong>
                    </p>
                    <p style="color: #856404; font-size: 0.85em; margin-top: 5px; opacity: 0.8;">
                        (includes ~$${Math.ceil(interestWith).toLocaleString()} interest over ${months} months)
                    </p>
                </div>
                
                <!-- WITHOUT PENALTIES -->
                <div style="background: #d4edda; border: 3px solid #28a745; border-radius: 15px; padding: 25px; text-align: center; box-shadow: 0 5px 20px rgba(40,167,69,0.2);">
                    <div style="background: #28a745; color: white; padding: 10px; border-radius: 10px; margin: -25px -25px 20px -25px;">
                        <strong>WITHOUT Penalties ‚≠ê</strong>
                    </div>
                    <p style="color: #155724; font-size: 0.95em; margin-bottom: 10px;">Starting balance: $${balanceWithoutPenalties.toLocaleString()}</p>
                    <div style="font-size: 2.4em; font-weight: bold; color: #28a745; margin: 10px 0;">
                        $${monthlyWithout.toLocaleString()}/mo
                    </div>
                    <p style="color: #155724; font-size: 1em; margin-top: 15px;">
                        Total paid: <strong>$${totalPaidWithout.toLocaleString()}</strong>
                    </p>
                    <div style="background: rgba(40,167,69,0.2); padding: 12px; border-radius: 8px; margin-top: 15px;">
                        <strong style="color: #155724; font-size: 1.1em;">üí∞ SAVE $${totalSavings.toLocaleString()} TOTAL</strong><br>
                        <span style="color: #155724; font-size: 0.9em;">($${penaltySavings.toLocaleString()} in penalties + $${Math.ceil(interestWith - interestWithout).toLocaleString()} less interest)</span>
                    </div>
                </div>
            `;
        }

        // ============================================
        // PENALTY DECISION SCREEN
        // ============================================
        function showPenaltyDecisionScreen() {
            const penaltySavings = window.penaltySavingsAmount || 0;
            const totalSavings = window.comparisonData ? window.comparisonData.totalSavings : penaltySavings;
            const resourcesContainer = document.getElementById('resourcesContainer');
            
            resourcesContainer.innerHTML = `
                <div style="padding: 20px; max-width: 800px; margin: 0 auto;">
                    <h2 style="text-align: center; color: #1e3c72; font-size: 1.8em; margin-bottom: 25px;">
                        ‚ú® Before You Set Up Your Payment Plan...
                    </h2>
                    
                    <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 35px; border-radius: 20px; margin-bottom: 35px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">üí∞</div>
                        <h3 style="color: white; font-size: 1.5em; margin-bottom: 10px;">Your Potential Penalty Savings:</h3>
                        <div style="font-size: 3em; font-weight: bold; margin: 15px 0;">
                            $${penaltySavings.toLocaleString()}
                        </div>
                        <p style="font-size: 1.1em; opacity: 0.95;">in penalties that could be removed</p>
                        
                        ${totalSavings > penaltySavings ? `
                        <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin-top: 20px;">
                            <p style="margin: 0; font-size: 1.1em;">
                                <strong>Total savings with reduced interest: $${totalSavings.toLocaleString()}</strong>
                            </p>
                        </div>
                        ` : ''}
                        
                        <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 10px; margin-top: 15px; text-align: left;">
                            <p style="margin: 0 0 10px 0; font-weight: bold;">‚úÖ Why check penalty abatement first:</p>
                            <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                                <li>Lower balance = lower monthly payment</li>
                                <li>Takes only 2 minutes to check</li>
                                <li>First-Time Abatement often approved same day</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Decision Cards -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                        
                        <div onclick="handlePenaltyDecision('yes')" 
                             style="background: white; border: 3px solid #28a745; border-radius: 15px; padding: 25px; cursor: pointer; transition: all 0.3s; text-align: center;"
                             onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 25px rgba(40,167,69,0.3)';"
                             onmouseout="this.style.transform='none'; this.style.boxShadow='none';">
                            <div style="font-size: 2.5em; margin-bottom: 15px;">‚úÖ</div>
                            <h3 style="color: #28a745; margin-bottom: 12px; font-size: 1.2em;">Yes, Check Penalty Abatement</h3>
                            <p style="color: #666; font-size: 0.95em; margin-bottom: 15px;">Opens in new window.<br>You won't lose your place here.</p>
                            <div style="background: #d4edda; padding: 12px; border-radius: 8px;">
                                <strong style="color: #155724;">üí° Recommended</strong>
                            </div>
                        </div>
                        
                        <div onclick="handlePenaltyDecision('no')" 
                             style="background: white; border: 3px solid #6c757d; border-radius: 15px; padding: 25px; cursor: pointer; transition: all 0.3s; text-align: center;"
                             onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 25px rgba(108,117,125,0.3)';"
                             onmouseout="this.style.transform='none'; this.style.boxShadow='none';">
                            <div style="font-size: 2.5em; margin-bottom: 15px;">‚è≠Ô∏è</div>
                            <h3 style="color: #6c757d; margin-bottom: 12px; font-size: 1.2em;">No, Continue to Payment Plan</h3>
                            <p style="color: #666; font-size: 0.95em; margin-bottom: 15px;">Skip penalty abatement.<br>Go straight to payment setup.</p>
                            <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                                <span style="color: #6c757d;">You can do this later</span>
                            </div>
                        </div>
                    </div>
                    
                    <style>
                        @media (max-width: 600px) {
                            div[style*="grid-template-columns: 1fr 1fr"] {
                                grid-template-columns: 1fr !important;
                            }
                        }
                    </style>
                </div>
            `;
            
            window.scrollTo(0, 0);
        }

        // ============================================
        // HANDLE PENALTY DECISION
        // ============================================
        function handlePenaltyDecision(choice) {
            if (choice === 'yes') {
                // Open penalty abatement tool in new window
                window.open('penalty-abatement-guide.html', '_blank');
                
                // Show confirmation screen
                const resourcesContainer = document.getElementById('resourcesContainer');
                resourcesContainer.innerHTML = `
                    <div style="padding: 40px; max-width: 700px; margin: 0 auto; text-align: center;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 20px;">
                            <div style="font-size: 4em; margin-bottom: 20px;">‚úÖ</div>
                            <h2 style="color: white; margin-bottom: 20px; font-size: 1.8em;">Penalty Tool Opened!</h2>
                            <p style="font-size: 1.15em; margin-bottom: 25px; opacity: 0.95;">
                                Complete the penalty abatement check in the new window, then come back here.
                            </p>
                            <button onclick="showResources()" 
                                    class="btn btn-success" 
                                    style="background: white; color: #667eea; padding: 18px 45px; font-size: 1.2em; font-weight: bold;">
                                I'm Ready ‚Üí Continue to Payment Plan
                            </button>
                            <p style="margin-top: 20px; font-size: 0.9em; opacity: 0.85;">
                                Didn't open? <a href="penalty-abatement-guide.html" target="_blank" style="color: white; text-decoration: underline;">Click here</a>
                            </p>
                        </div>
                    </div>
                `;
            } else {
                // Skip to payment plan resources
                showResources();
            }
            
            window.scrollTo(0, 0);
        }

        // Notice database
        const noticeDatabase = {
            'CP11': {
                type: 'CP11',
                name: 'Changes to Your Return',
                urgency: 'medium',
                meaning: 'The IRS made changes to your tax return, which resulted in you owing more money than you originally reported.',
                reason: 'The IRS corrected mathematical errors, adjusted credits/deductions you claimed, or added income that wasn\'t reported on your return.',
                deadline: '60 days to pay or dispute',
                hasDeadline: true,
                actions: [
                    'Review the notice carefully - compare it to your original return line by line',
                    'If you agree: Pay the additional amount or set up a payment plan',
                    'If you disagree: Respond in writing with documentation supporting your original return',
                    'Request penalty abatement if applicable'
                ],
                followUpQuestions: [
                    {
                        id: 'amount',
                        question: 'How much additional tax does the notice say you owe?',
                        type: 'amount',
                        options: ['Under $1,000', '$1,000 - $5,000', '$5,000 - $15,000', 'Over $15,000']
                    },
                    {
                        id: 'agreeWithChanges',
                        question: 'Do you agree with the IRS\'s changes?',
                        type: 'radio',
                        options: ['Yes, they are correct', 'No, they made an error', 'Partially agree', 'Not sure']
                    },
                    {
                        id: 'hasBalancePenalties',
                        question: 'Does the notice show penalties on your balance?',
                        type: 'yesno'
                    },
                    {
                        id: 'penaltyFTF',
                        question: 'Failure to FILE Penalty (exact amount from notice):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'penaltyFTP',
                        question: 'Failure to PAY Penalty (exact amount from notice):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'penaltyOther',
                        question: 'Any OTHER Penalties (exact amount):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    }
                ],
                needsProfessional: (answers) => 
                    answers.amount === 'Over $15,000' || 
                    answers.agreeWithChanges === 'No, they made an error' ||
                    answers.agreeWithChanges === 'Not sure'
            },
            'CP14': {
                type: 'CP14',
                name: 'Balance Due - First Notice',
                urgency: 'medium',
                meaning: 'You owe money to the IRS. This is the first notice about an unpaid tax balance.',
                reason: 'You filed your return showing a balance due but didn\'t pay, or the IRS made changes to your return resulting in additional tax.',
                deadline: '21 days from notice date',
                hasDeadline: true,
                actions: [
                    'Pay in full using IRS Direct Pay (www.irs.gov/directpay)',
                    'Set up a payment plan if you can\'t pay in full',
                    'Request penalty abatement if you qualify'
                ],
                followUpQuestions: [
                    {
                        id: 'amount',
                        question: 'How much do you owe (total on notice)?',
                        type: 'amount',
                        options: ['Under $10,000', '$10,000 - $15,000', '$15,000 - $25,000', 'Over $25,000']
                    },
                    {
                        id: 'canPayFull',
                        question: 'Can you pay the full amount within 6 months?',
                        type: 'yesno'
                    },
                    {
                        id: 'hasBalancePenalties',
                        question: 'Does your notice show penalty charges?',
                        type: 'yesno'
                    },
                    {
                        id: 'penaltyFTF',
                        question: 'Failure to FILE Penalty (exact amount from notice):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'penaltyFTP',
                        question: 'Failure to PAY Penalty (exact amount from notice):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'penaltyOther',
                        question: 'Any OTHER Penalties (exact amount):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    }
                ],
                needsProfessional: (answers) => false // Strategic options shown inline, not forcing bottom section
            },
            'CP501': {
                type: 'CP501',
                name: 'Reminder Notice - Balance Due',
                urgency: 'medium',
                meaning: 'This is a reminder that you still owe money. This is your second notice.',
                reason: 'You didn\'t respond to CP14 or didn\'t pay the balance due.',
                deadline: 'Immediate action recommended',
                hasDeadline: true,
                actions: [
                    'Pay immediately to avoid further collection actions',
                    'Set up payment plan before escalation to CP503',
                    'If you already paid, contact IRS with proof of payment'
                ],
                followUpQuestions: [
                    {
                        id: 'amount',
                        question: 'How much do you currently owe?',
                        type: 'amount',
                        options: ['Under $15,000', '$15,000 - $25,000', 'Over $25,000']
                    },
                    {
                        id: 'receivedCP14',
                        question: 'Did you receive CP14 before this?',
                        type: 'yesno'
                    },
                    {
                        id: 'hasBalancePenalties',
                        question: 'Does your notice show penalty charges?',
                        type: 'yesno'
                    },
                    {
                        id: 'penaltyFTF',
                        question: 'Failure to FILE Penalty (exact amount from notice):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'penaltyFTP',
                        question: 'Failure to PAY Penalty (exact amount from notice):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'penaltyOther',
                        question: 'Any OTHER Penalties (exact amount):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    }
                ],
                needsProfessional: (answers) => false // Strategic options shown inline
            },
            'CP2000': {
                type: 'CP2000',
                name: 'Proposed Changes to Your Return',
                urgency: 'high',
                meaning: 'The IRS has information that doesn\'t match your tax return and is proposing changes that increase your tax.',
                reason: 'IRS\'s Automated Underreporter system found discrepancies between your return and third-party reports (W-2s, 1099s, etc.)',
                deadline: '30 days to respond',
                hasDeadline: true,
                actions: [
                    'Compare the notice to your tax return line-by-line',
                    'Gather documentation to support your position',
                    'Respond by the deadline even if you need more time',
                    'Consider professional help - this is complex'
                ],
                followUpQuestions: [
                    {
                        id: 'proposedAmount',
                        question: 'How much additional tax are they proposing?',
                        type: 'amount',
                        options: ['Under $5,000', '$5,000 - $10,000', 'Over $10,000']
                    },
                    {
                        id: 'agreeWithChanges',
                        question: 'Do you agree with the proposed changes?',
                        type: 'radio',
                        options: ['I agree completely', 'I partially agree', 'I disagree completely', 'I\'m not sure']
                    },
                    {
                        id: 'hasDocumentation',
                        question: 'Do you have documentation to dispute the changes?',
                        type: 'yesno'
                    }
                ],
                needsProfessional: (answers) => 
                    answers.proposedAmount === 'Over $10,000' || 
                    answers.agreeWithChanges === 'I disagree completely' ||
                    answers.agreeWithChanges === 'I\'m not sure'
            },
            'CP90': {
                type: 'CP90',
                name: 'Notice of Intent to Levy',
                urgency: 'critical',
                meaning: 'FINAL WARNING: The IRS is about to seize your assets. This is your last chance to act before enforced collection.',
                reason: 'You\'ve ignored multiple balance due notices and the IRS is moving to enforced collection.',
                deadline: '30 days to request Collection Due Process hearing',
                hasDeadline: true,
                actions: [
                    'DO NOT IGNORE THIS - Act within 24-48 hours',
                    'Call the number on the notice immediately',
                    'Request Collection Due Process hearing (Form 12153)',
                    'Get professional help NOW - this is an emergency'
                ],
                followUpQuestions: [
                    {
                        id: 'totalOwed',
                        question: 'Total amount owed shown on notice?',
                        type: 'text',
                        placeholder: 'Enter amount'
                    },
                    {
                        id: 'canPayFull',
                        question: 'Can you pay in full right now?',
                        type: 'yesno'
                    },
                    {
                        id: 'hasUnfiledReturns',
                        question: 'Do you have any unfiled tax returns?',
                        type: 'yesno'
                    }
                ],
                needsProfessional: () => true
            },
            'CP523': {
                type: 'CP523',
                name: 'Intent to Terminate Installment Agreement',
                urgency: 'high',
                meaning: 'Your payment plan is about to be terminated. You have 30 days to fix the default.',
                reason: 'You missed a payment, filed a return late, owed new taxes, or didn\'t respond to IRS correspondence.',
                deadline: '30 days to cure default',
                hasDeadline: true,
                actions: [
                    'Make all missed payments immediately',
                    'Call the number on the notice',
                    'Explain the situation and request reinstatement',
                    'Fix the underlying compliance issue'
                ],
                followUpQuestions: [
                    {
                        id: 'defaultReason',
                        question: 'Why did you default?',
                        type: 'radio',
                        options: ['Missed payment(s)', 'Filed return late', 'Owed new taxes', 'Other reason', 'Not sure']
                    },
                    {
                        id: 'canCatchUp',
                        question: 'Can you pay all missed payments now?',
                        type: 'yesno'
                    },
                    {
                        id: 'previousDefaults',
                        question: 'Have you defaulted on an IRS payment plan before?',
                        type: 'yesno'
                    }
                ],
                needsProfessional: (answers) => 
                    answers.canCatchUp === 'no' || 
                    answers.previousDefaults === 'yes'
            },
            'CP504': {
                type: 'CP504',
                name: 'Urgent Notice - Intent to Seize Assets',
                urgency: 'critical',
                meaning: 'URGENT: The IRS intends to seize (levy) your state tax refund or other property. This is a serious escalation.',
                reason: 'You haven\'t responded to previous balance due notices (CP14, CP501, etc.) and the IRS is moving toward enforced collection.',
                deadline: 'Immediate - typically 30 days before levy action',
                hasDeadline: true,
                actions: [
                    'DO NOT IGNORE - This is one step before CP90 (final levy notice)',
                    'Call the IRS immediately at the number on your notice',
                    'Pay in full if possible, or set up a payment plan TODAY',
                    'Your state tax refund WILL be seized if you don\'t act',
                    'Consider professional help - you\'re running out of time'
                ],
                followUpQuestions: [
                    {
                        id: 'amount',
                        question: 'How much do you owe according to this notice?',
                        type: 'amount',
                        options: ['Under $10,000', '$10,000 - $15,000', '$15,000 - $25,000', 'Over $25,000']
                    },
                    {
                        id: 'canPayFull',
                        question: 'Can you pay the full amount right now?',
                        type: 'yesno'
                    },
                    {
                        id: 'hasBalancePenalties',
                        question: 'Does your notice show penalty charges?',
                        type: 'yesno'
                    },
                    {
                        id: 'penaltyFTF',
                        question: 'Failure to FILE Penalty (exact amount from notice):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'penaltyFTP',
                        question: 'Failure to PAY Penalty (exact amount from notice):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'penaltyOther',
                        question: 'Any OTHER Penalties (exact amount):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'previousNotices',
                        question: 'Have you received previous notices about this debt?',
                        type: 'radio',
                        options: ['Yes, multiple notices', 'Yes, one or two', 'No, this is the first', 'Not sure']
                    }
                ],
                needsProfessional: (answers) => 
                    answers.amount === 'Over $25,000' || 
                    answers.canPayFull === 'no'
            },
            'CP91': {
                type: 'CP91',
                name: 'Final Notice Before Levy on Social Security',
                urgency: 'critical',
                meaning: 'CRITICAL: The IRS will begin taking up to 15% of your Social Security benefits to pay your tax debt.',
                reason: 'You have an unpaid tax debt and haven\'t responded to previous collection notices. The IRS is now targeting your Social Security income.',
                deadline: '30 days before levy begins',
                hasDeadline: true,
                actions: [
                    'THIS IS EXTREMELY URGENT - Your Social Security is at risk',
                    'Call the IRS IMMEDIATELY at the number on your notice',
                    'Request a Collection Due Process (CDP) hearing using Form 12153',
                    'Explore Currently Not Collectible status if you can\'t afford to pay',
                    'GET PROFESSIONAL HELP - This affects your monthly income'
                ],
                followUpQuestions: [
                    {
                        id: 'amount',
                        question: 'Total amount the IRS says you owe?',
                        type: 'amount',
                        options: ['Under $10,000', '$10,000 - $25,000', '$25,000 - $50,000', 'Over $50,000']
                    },
                    {
                        id: 'ssIncome',
                        question: 'Is Social Security your primary source of income?',
                        type: 'yesno'
                    },
                    {
                        id: 'canAffordPayment',
                        question: 'Could you afford ANY monthly payment toward this debt?',
                        type: 'radio',
                        options: ['Yes, I can afford payments', 'Maybe a small amount', 'No, I\'m barely getting by', 'Not sure']
                    },
                    {
                        id: 'hasOtherIncome',
                        question: 'Do you have income sources besides Social Security?',
                        type: 'yesno'
                    }
                ],
                needsProfessional: () => true
            },
            'CP298': {
                type: 'CP298',
                name: 'Final Notice Before Levy on Social Security',
                urgency: 'critical',
                meaning: 'CRITICAL: The IRS will begin taking up to 15% of your Social Security benefits to pay your tax debt.',
                reason: 'You have an unpaid tax debt and haven\'t responded to previous collection notices. The IRS is now targeting your Social Security income.',
                deadline: '30 days before levy begins',
                hasDeadline: true,
                actions: [
                    'THIS IS EXTREMELY URGENT - Your Social Security is at risk',
                    'Call the IRS IMMEDIATELY at the number on your notice',
                    'Request a Collection Due Process (CDP) hearing using Form 12153',
                    'Explore Currently Not Collectible status if you can\'t afford to pay',
                    'GET PROFESSIONAL HELP - This affects your monthly income'
                ],
                followUpQuestions: [
                    {
                        id: 'amount',
                        question: 'Total amount the IRS says you owe?',
                        type: 'amount',
                        options: ['Under $10,000', '$10,000 - $25,000', '$25,000 - $50,000', 'Over $50,000']
                    },
                    {
                        id: 'ssIncome',
                        question: 'Is Social Security your primary source of income?',
                        type: 'yesno'
                    },
                    {
                        id: 'canAffordPayment',
                        question: 'Could you afford ANY monthly payment toward this debt?',
                        type: 'radio',
                        options: ['Yes, I can afford payments', 'Maybe a small amount', 'No, I\'m barely getting by', 'Not sure']
                    },
                    {
                        id: 'hasOtherIncome',
                        question: 'Do you have income sources besides Social Security?',
                        type: 'yesno'
                    }
                ],
                needsProfessional: () => true
            },
            'CP161': {
                type: 'CP161',
                name: 'Balance Due - Request for Payment',
                urgency: 'medium',
                meaning: 'You have an unpaid balance on your account. This is a formal request for payment.',
                reason: 'You filed a return with a balance due that hasn\'t been paid, or the IRS made adjustments resulting in additional tax owed.',
                deadline: '21 days from notice date',
                hasDeadline: true,
                actions: [
                    'Pay in full if possible using IRS Direct Pay (www.irs.gov/directpay)',
                    'Set up a payment plan if you can\'t pay in full',
                    'Request penalty abatement if you have a clean compliance history',
                    'Don\'t ignore this - it will escalate to CP504 and then levy notices'
                ],
                followUpQuestions: [
                    {
                        id: 'amount',
                        question: 'How much does the notice say you owe?',
                        type: 'amount',
                        options: ['Under $10,000', '$10,000 - $15,000', '$15,000 - $25,000', 'Over $25,000']
                    },
                    {
                        id: 'canPayFull',
                        question: 'Can you pay the full amount now?',
                        type: 'yesno'
                    },
                    {
                        id: 'hasBalancePenalties',
                        question: 'Does your notice show penalty charges?',
                        type: 'yesno'
                    },
                    {
                        id: 'penaltyFTF',
                        question: 'Failure to FILE Penalty (exact amount from notice):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'penaltyFTP',
                        question: 'Failure to PAY Penalty (exact amount from notice):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'penaltyOther',
                        question: 'Any OTHER Penalties (exact amount):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    }
                ],
                needsProfessional: (answers) => 
                    answers.amount === 'Over $25,000'
            },
            'CP59': {
                type: 'CP59',
                name: 'Request for Your Tax Return',
                urgency: 'high',
                meaning: 'The IRS believes you were required to file a tax return but they have no record of receiving one.',
                reason: 'The IRS received income information (W-2s, 1099s) showing you earned money, but you didn\'t file a return for that year.',
                deadline: '30 days to respond',
                hasDeadline: true,
                actions: [
                    'File the missing return IMMEDIATELY if you were required to file',
                    'If you already filed, send proof (copy of return with certified mail receipt)',
                    'If you weren\'t required to file, respond explaining why',
                    'Don\'t ignore this - the IRS may file a Substitute for Return (SFR) for you with higher taxes'
                ],
                followUpQuestions: [
                    {
                        id: 'didFile',
                        question: 'Did you file a return for this tax year?',
                        type: 'radio',
                        options: ['Yes, I filed it', 'No, I didn\'t file', 'I\'m not sure']
                    },
                    {
                        id: 'hadIncome',
                        question: 'Did you have income that year?',
                        type: 'radio',
                        options: ['Yes, I had W-2/1099 income', 'Yes, but under filing threshold', 'No income that year', 'Not sure']
                    },
                    {
                        id: 'yearsUnfiled',
                        question: 'Do you have other years you haven\'t filed?',
                        type: 'radio',
                        options: ['No, just this year', 'Yes, 1-2 other years', 'Yes, 3+ years', 'Not sure']
                    },
                    {
                        id: 'hasRecords',
                        question: 'Do you have records/documents to prepare the return?',
                        type: 'yesno'
                    }
                ],
                needsProfessional: (answers) => 
                    answers.yearsUnfiled === 'Yes, 3+ years' ||
                    answers.didFile === 'I\'m not sure' ||
                    answers.hasRecords === 'no'
            },
            'CP12': {
                type: 'CP12',
                name: 'Changes to Tax Return - Overpayment',
                urgency: 'low',
                meaning: 'GOOD NEWS: The IRS made changes to correct a miscalculation on your tax return, and you\'re getting a refund or larger refund.',
                reason: 'The IRS found a math error or calculation mistake that worked in your favor.',
                deadline: 'No action required if you agree',
                hasDeadline: false,
                actions: [
                    'Review the changes to make sure you agree with them',
                    'If you agree, no action needed - your refund should arrive in 4-6 weeks',
                    'If you disagree, contact the IRS at 1-800-829-8374 to review your account',
                    'Keep this notice with your tax records'
                ],
                followUpQuestions: [
                    {
                        id: 'agreeWithChanges',
                        question: 'Do you agree with the IRS\'s changes?',
                        type: 'radio',
                        options: ['Yes, they look correct', 'No, I think they made an error', 'Not sure']
                    }
                ],
                needsProfessional: (answers) => answers.agreeWithChanges === 'No, I think they made an error'
            },
            'CP13': {
                type: 'CP13',
                name: 'Changes to Tax Return - No Balance Due',
                urgency: 'low',
                meaning: 'The IRS made changes to your tax return, but the result is that you don\'t owe anything and aren\'t due a refund.',
                reason: 'The IRS corrected errors on your return, and after the changes, your account balance is zero.',
                deadline: 'No action required if you agree',
                hasDeadline: false,
                actions: [
                    'Review the changes carefully',
                    'If you agree, no action is needed',
                    'If you disagree, contact the IRS within 60 days',
                    'Keep this notice for your records'
                ],
                followUpQuestions: [
                    {
                        id: 'agreeWithChanges',
                        question: 'Do you agree with the IRS\'s changes?',
                        type: 'radio',
                        options: ['Yes, they look correct', 'No, I disagree', 'Not sure']
                    }
                ],
                needsProfessional: (answers) => answers.agreeWithChanges === 'No, I disagree'
            },
            'CP23': {
                type: 'CP23',
                name: 'Estimated Tax Payment Discrepancy - Balance Due',
                urgency: 'medium',
                meaning: 'The IRS found a difference between the estimated tax payments you claimed on your return and what they have on record. You owe the difference.',
                reason: 'Your estimated tax payments didn\'t match what the IRS received. This could be a timing issue, misapplied payments, or payments you thought were made but weren\'t.',
                deadline: 'Pay by the date on your notice',
                hasDeadline: true,
                actions: [
                    'Check your records for all estimated tax payments you made',
                    'Verify dates and amounts against the IRS list on your notice',
                    'If payments are missing from their records, gather proof (cancelled checks, bank statements)',
                    'If you agree, pay by the due date or set up a payment plan',
                    'If you disagree, call the number on your notice with your payment proof'
                ],
                followUpQuestions: [
                    {
                        id: 'amount',
                        question: 'How much does the notice say you owe?',
                        type: 'amount',
                        options: ['Under $1,000', '$1,000 - $5,000', '$5,000 - $15,000', 'Over $15,000']
                    },
                    {
                        id: 'agreeWithChanges',
                        question: 'Do you agree with the payment amounts they show?',
                        type: 'radio',
                        options: ['Yes, they\'re correct', 'No, payments are missing', 'Not sure']
                    },
                    {
                        id: 'hasBalancePenalties',
                        question: 'Does your notice show penalty charges?',
                        type: 'yesno'
                    },
                    {
                        id: 'penaltyFTF',
                        question: 'Failure to FILE Penalty (exact amount from notice):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'penaltyFTP',
                        question: 'Failure to PAY Penalty (exact amount from notice):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'penaltyOther',
                        question: 'Any OTHER Penalties (exact amount):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    }
                ],
                needsProfessional: (answers) => 
                    answers.amount === 'Over $15,000' ||
                    answers.agreeWithChanges === 'No, payments are missing'
            },
            'CP24': {
                type: 'CP24',
                name: 'Estimated Tax Payment Discrepancy - Overpayment',
                urgency: 'low',
                meaning: 'GOOD NEWS: The IRS found a difference between your estimated tax payments and their records, and you\'re due a refund.',
                reason: 'The IRS found you paid more in estimated taxes than you claimed, so you have a credit.',
                deadline: 'No action required if you agree',
                hasDeadline: false,
                actions: [
                    'Review the payment list on your notice',
                    'Verify all your payments are accounted for',
                    'If you agree, your refund should arrive in 4-6 weeks',
                    'If you disagree or payments are missing, contact the IRS'
                ],
                followUpQuestions: [
                    {
                        id: 'agreeWithChanges',
                        question: 'Do you agree with the payment amounts shown?',
                        type: 'radio',
                        options: ['Yes, looks correct', 'No, I paid more than they show', 'Not sure']
                    }
                ],
                needsProfessional: (answers) => answers.agreeWithChanges === 'No, I paid more than they show'
            },
            'CP49': {
                type: 'CP49',
                name: 'Refund Applied to Tax Debt',
                urgency: 'medium',
                meaning: 'The IRS used your tax refund to pay a tax debt you owe. You won\'t receive this refund.',
                reason: 'You have an outstanding balance with the IRS from a previous year, and they applied your current refund to that debt.',
                deadline: 'Contact IRS if you disagree',
                hasDeadline: false,
                actions: [
                    'Review which tax year debt your refund was applied to',
                    'Verify the amount applied matches what you owed',
                    'Check if the full refund was used or if you\'ll receive a partial refund',
                    'If you disagree with the debt, contact the IRS immediately'
                ],
                followUpQuestions: [
                    {
                        id: 'agreeWithDebt',
                        question: 'Do you agree that you owed this debt?',
                        type: 'radio',
                        options: ['Yes, I knew I owed this', 'No, I didn\'t know about this debt', 'Partially - the amount seems wrong', 'Not sure']
                    },
                    {
                        id: 'refundCoveredDebt',
                        question: 'Did your refund cover the full debt?',
                        type: 'radio',
                        options: ['Yes, debt is now paid off', 'No, I still owe more', 'Not sure']
                    }
                ],
                needsProfessional: (answers) => 
                    answers.agreeWithDebt === 'No, I didn\'t know about this debt' ||
                    answers.agreeWithDebt === 'Partially - the amount seems wrong'
            },
            'CP503': {
                type: 'CP503',
                name: 'Second Reminder - Balance Due',
                urgency: 'high',
                meaning: 'This is your SECOND reminder that you have an unpaid balance. The IRS hasn\'t heard from you.',
                reason: 'You didn\'t respond to the first notice (CP501) and still haven\'t paid or set up a payment plan.',
                deadline: 'Immediate action required',
                hasDeadline: true,
                actions: [
                    'Don\'t ignore this - the next notice (CP504) will threaten levy action',
                    'Pay in full if possible',
                    'Set up a payment plan today if you can\'t pay in full',
                    'Call the IRS if you disagree with the balance'
                ],
                followUpQuestions: [
                    {
                        id: 'amount',
                        question: 'How much do you owe?',
                        type: 'amount',
                        options: ['Under $10,000', '$10,000 - $15,000', '$15,000 - $25,000', 'Over $25,000']
                    },
                    {
                        id: 'canPayFull',
                        question: 'Can you pay the full amount now?',
                        type: 'yesno'
                    },
                    {
                        id: 'hasBalancePenalties',
                        question: 'Does your notice show penalty charges?',
                        type: 'yesno'
                    },
                    {
                        id: 'penaltyFTF',
                        question: 'Failure to FILE Penalty (exact amount from notice):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'penaltyFTP',
                        question: 'Failure to PAY Penalty (exact amount from notice):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    },
                    {
                        id: 'penaltyOther',
                        question: 'Any OTHER Penalties (exact amount):',
                        type: 'penaltyAmount',
                        showIf: (answers) => answers.hasBalancePenalties === 'yes'
                    }
                ],
                needsProfessional: (answers) => answers.amount === 'Over $25,000'
            },
            'CP504B': {
                type: 'CP504B',
                name: 'Urgent - Intent to Levy Property',
                urgency: 'critical',
                meaning: 'URGENT: The IRS intends to levy (seize) your property or rights to property to pay your tax debt.',
                reason: 'You haven\'t responded to multiple notices and the IRS is moving to enforced collection of your assets.',
                deadline: 'Immediate - before levy date shown',
                hasDeadline: true,
                actions: [
                    'THIS IS SERIOUS - Act immediately',
                    'Pay in full if at all possible',
                    'Set up a payment plan TODAY - don\'t wait',
                    'Consider professional help - you\'re close to levy action'
                ],
                followUpQuestions: [
                    {
                        id: 'amount',
                        question: 'How much do you owe?',
                        type: 'amount',
                        options: ['Under $10,000', '$10,000 - $25,000', '$25,000 - $50,000', 'Over $50,000']
                    },
                    {
                        id: 'canPayFull',
                        question: 'Can you pay the full amount now?',
                        type: 'yesno'
                    },
                    {
                        id: 'hasAssets',
                        question: 'Do you have assets the IRS could levy (bank accounts, property, wages)?',
                        type: 'yesno'
                    }
                ],
                needsProfessional: () => true
            },
            'CP2051': {
                type: 'CP2051',
                name: 'Information Request - Unreported Income',
                urgency: 'high',
                meaning: 'The IRS has received income information that wasn\'t on your tax return. They need you to respond.',
                reason: 'Third parties (employers, banks, etc.) reported income to the IRS that doesn\'t match what you reported on your return.',
                deadline: 'Respond by date on notice',
                hasDeadline: true,
                actions: [
                    'Review the income information the IRS received',
                    'Compare it to your tax return and records',
                    'Complete the response form whether the information is correct OR incorrect',
                    'Don\'t ignore this - it\'s similar to a CP2000 but requires your response'
                ],
                followUpQuestions: [
                    {
                        id: 'incomeCorrect',
                        question: 'Is the income information the IRS shows correct?',
                        type: 'radio',
                        options: ['Yes, I forgot to report it', 'No, it\'s incorrect', 'Partially correct', 'Not sure']
                    },
                    {
                        id: 'hasDocumentation',
                        question: 'Do you have documentation to support your position?',
                        type: 'yesno'
                    }
                ],
                needsProfessional: (answers) => 
                    answers.incomeCorrect === 'No, it\'s incorrect' ||
                    answers.incomeCorrect === 'Not sure'
            },
            'CP297': {
                type: 'CP297',
                name: 'Notice of Levy Issued - Right to Hearing',
                urgency: 'critical',
                meaning: 'CRITICAL: A levy has been issued against your assets. The IRS is actively collecting.',
                reason: 'You have an unpaid balance and the IRS has moved to enforced collection by issuing a levy.',
                deadline: '30 days to request Collection Due Process hearing',
                hasDeadline: true,
                actions: [
                    'THIS IS AN EMERGENCY - The IRS is seizing your assets',
                    'Request a Collection Due Process (CDP) hearing immediately using Form 12153',
                    'This gives you the right to appeal and stops collection temporarily',
                    'GET PROFESSIONAL HELP NOW - this requires immediate expert intervention'
                ],
                followUpQuestions: [
                    {
                        id: 'amount',
                        question: 'Total amount the IRS says you owe?',
                        type: 'amount',
                        options: ['Under $10,000', '$10,000 - $25,000', '$25,000 - $50,000', 'Over $50,000']
                    },
                    {
                        id: 'assetsSeized',
                        question: 'Have any assets already been seized (bank account frozen, wages garnished)?',
                        type: 'yesno'
                    }
                ],
                needsProfessional: () => true
            },
            'LT11': {
                type: 'LT11',
                name: 'Final Notice of Intent to Levy',
                urgency: 'critical',
                meaning: 'FINAL WARNING: The IRS will levy your bank accounts, wages, and other assets. They may also file a Federal Tax Lien.',
                reason: 'You have an unpaid balance and have not responded to previous notices. This is your final warning before enforced collection.',
                deadline: '30 days to request Collection Due Process hearing',
                hasDeadline: true,
                actions: [
                    'DO NOT IGNORE - This is the final notice before levy action',
                    'Pay the amount shown immediately if possible',
                    'Request a Collection Due Process hearing (Form 12153) within 30 days',
                    'Set up a payment plan immediately',
                    'GET PROFESSIONAL HELP - You\'re at the final stage before enforced collection'
                ],
                followUpQuestions: [
                    {
                        id: 'amount',
                        question: 'Total amount you owe?',
                        type: 'amount',
                        options: ['Under $10,000', '$10,000 - $25,000', '$25,000 - $50,000', 'Over $50,000']
                    },
                    {
                        id: 'canPayFull',
                        question: 'Can you pay in full right now?',
                        type: 'yesno'
                    },
                    {
                        id: 'hasUnfiledReturns',
                        question: 'Do you have any unfiled tax returns?',
                        type: 'yesno'
                    }
                ],
                needsProfessional: () => true
            },
            'Letter1058': {
                type: 'Letter1058',
                name: 'Final Notice of Intent to Levy',
                urgency: 'critical',
                meaning: 'FINAL WARNING: The IRS will levy your bank accounts, wages, and other assets. They may also file a Federal Tax Lien.',
                reason: 'You have an unpaid balance and have not responded to previous notices. This is your final warning before enforced collection.',
                deadline: '30 days to request Collection Due Process hearing',
                hasDeadline: true,
                actions: [
                    'DO NOT IGNORE - This is the final notice before levy action',
                    'Pay the amount shown immediately if possible',
                    'Request a Collection Due Process hearing (Form 12153) within 30 days',
                    'Set up a payment plan immediately',
                    'GET PROFESSIONAL HELP - You\'re at the final stage before enforced collection'
                ],
                followUpQuestions: [
                    {
                        id: 'amount',
                        question: 'Total amount you owe?',
                        type: 'amount',
                        options: ['Under $10,000', '$10,000 - $25,000', '$25,000 - $50,000', 'Over $50,000']
                    },
                    {
                        id: 'canPayFull',
                        question: 'Can you pay in full right now?',
                        type: 'yesno'
                    },
                    {
                        id: 'hasUnfiledReturns',
                        question: 'Do you have any unfiled tax returns?',
                        type: 'yesno'
                    }
                ],
                needsProfessional: () => true
            },
            'Letter525': {
                type: 'Letter525',
                name: 'Examination Report (30-Day Letter)',
                urgency: 'high',
                meaning: 'The IRS has completed an audit/examination of your tax return and is proposing changes. You have 30 days to respond.',
                reason: 'The IRS examined your return and found issues. This letter contains their proposed changes and additional tax owed.',
                deadline: '30 days to agree or appeal',
                hasDeadline: true,
                actions: [
                    'Review the proposed changes carefully',
                    'If you agree, sign and return the form',
                    'If you disagree, you can request a conference with the examiner\'s supervisor',
                    'You can also request an appeal with the IRS Appeals Office',
                    'Consider professional help for audit disputes'
                ],
                followUpQuestions: [
                    {
                        id: 'proposedAmount',
                        question: 'How much additional tax are they proposing?',
                        type: 'amount',
                        options: ['Under $5,000', '$5,000 - $15,000', '$15,000 - $50,000', 'Over $50,000']
                    },
                    {
                        id: 'agreeWithChanges',
                        question: 'Do you agree with their proposed changes?',
                        type: 'radio',
                        options: ['Yes, they\'re correct', 'Partially agree', 'No, I disagree', 'Not sure']
                    },
                    {
                        id: 'hasDocumentation',
                        question: 'Do you have documentation to dispute their findings?',
                        type: 'yesno'
                    }
                ],
                needsProfessional: (answers) => 
                    answers.proposedAmount === 'Over $50,000' ||
                    answers.agreeWithChanges === 'No, I disagree' ||
                    answers.agreeWithChanges === 'Not sure'
            },
            'Letter531': {
                type: 'Letter531',
                name: 'Notice of Deficiency (90-Day Letter)',
                urgency: 'critical',
                meaning: 'IMPORTANT: This is a formal, legal notice that the IRS has determined you owe additional tax. You have 90 days to petition Tax Court.',
                reason: 'The IRS has made a final determination of tax deficiency. This is their official legal notice before they can assess the tax.',
                deadline: '90 days to petition Tax Court (150 days if outside US)',
                hasDeadline: true,
                actions: [
                    'This is a LEGAL NOTICE - the deadline is absolute',
                    'You have 90 days to file a petition with the US Tax Court if you disagree',
                    'If you don\'t petition within 90 days, the IRS will assess the tax and you lose your right to Tax Court',
                    'If you agree, you can sign and return the form',
                    'STRONGLY CONSIDER PROFESSIONAL HELP - Tax Court petitions are complex'
                ],
                followUpQuestions: [
                    {
                        id: 'proposedAmount',
                        question: 'How much additional tax is the IRS proposing?',
                        type: 'amount',
                        options: ['Under $10,000', '$10,000 - $25,000', '$25,000 - $100,000', 'Over $100,000']
                    },
                    {
                        id: 'agreeWithChanges',
                        question: 'Do you agree with the IRS\'s determination?',
                        type: 'radio',
                        options: ['Yes, I agree', 'Partially agree', 'No, I strongly disagree', 'Not sure']
                    },
                    {
                        id: 'daysRemaining',
                        question: 'How many days until the 90-day deadline?',
                        type: 'radio',
                        options: ['More than 60 days', '30-60 days', 'Less than 30 days', 'Less than 2 weeks']
                    }
                ],
                needsProfessional: () => true
            },
            'Letter12C': {
                type: 'Letter12C',
                name: 'Request for Additional Information',
                urgency: 'medium',
                meaning: 'The IRS needs additional information or documentation to process your tax return.',
                reason: 'Your return is incomplete or the IRS needs verification of items you claimed (income, deductions, credits, etc.).',
                deadline: 'Respond by date on letter (typically 30 days)',
                hasDeadline: true,
                actions: [
                    'Read the letter carefully - it tells you exactly what they need',
                    'Gather the requested documents',
                    'Respond by the deadline to avoid delays in processing your return',
                    'Send copies, not originals',
                    'Use certified mail and keep copies of everything you send'
                ],
                followUpQuestions: [
                    {
                        id: 'infoType',
                        question: 'What type of information are they requesting?',
                        type: 'radio',
                        options: ['Income verification (W-2, 1099)', 'Deduction documentation', 'Credit verification (EIC, Child Tax Credit)', 'Identity verification', 'Other/multiple items']
                    },
                    {
                        id: 'hasDocuments',
                        question: 'Do you have the documents they\'re requesting?',
                        type: 'radio',
                        options: ['Yes, I have everything', 'I have some of it', 'No, I need to get them', 'Not sure what they need']
                    }
                ],
                needsProfessional: (answers) => 
                    answers.hasDocuments === 'Not sure what they need' ||
                    answers.infoType === 'Other/multiple items'
            }
        };

        // File upload handling
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const analyzeBtn = document.getElementById('analyzeBtn');

        uploadZone.addEventListener('click', () => fileInput.click());

        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            const validTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
            const maxSize = 10 * 1024 * 1024;

            if (!validTypes.includes(file.type)) {
                alert('Please upload a PDF, JPG, or PNG file.');
                return;
            }

            if (file.size > maxSize) {
                alert('File size must be less than 10MB.');
                return;
            }

            uploadedFile = file;
            document.getElementById('fileName').textContent = `File: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
            document.getElementById('filePreview').style.display = 'block';
            analyzeBtn.disabled = false;
        }

        analyzeBtn.addEventListener('click', () => {
            goToStep(3);
            
            setTimeout(() => {
                const detectedNotice = detectNoticeFromFile(uploadedFile);
                
                if (detectedNotice) {
                    // Show verification step
                    showDetectionVerification(detectedNotice);
                } else {
                    goToStep(2);
                }
            }, 2000);
        });

        function showDetectionVerification(detectedCode) {
            goToStep(3); // Stay on loading/detection page but update content
            
            const step3 = document.getElementById('step3');
            step3.innerHTML = `
                <div style="padding: 20px;">
                    <div class="success-box">
                        <h3 style="margin-bottom: 15px;">‚úì We Detected Your Notice</h3>
                        <p style="font-size: 1.3em; font-weight: bold; color: #1e3c72; margin: 15px 0;">Notice Code: ${detectedCode}</p>
                    </div>

                    <div class="question-box">
                        <div class="question">Is this the correct notice code from your letter?</div>
                        
                        <div style="background: #e8f4f8; padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <h4 style="color: #1e3c72; margin-bottom: 15px;">üìç Where to Find Your Notice Number:</h4>
                            <p style="margin-bottom: 15px;">Look at the <strong>top-right corner</strong> of your IRS letter. You should see something like:</p>
                            
                            <div style="background: white; padding: 20px; border: 2px solid #667eea; border-radius: 8px; margin: 15px 0; font-family: 'Courier New', monospace;">
                                <div style="text-align: right; color: #666; font-size: 0.9em;">
                                    <p>Notice: <strong style="color: #1e3c72; font-size: 1.2em;">CP14</strong></p>
                                    <p>Notice date: December 15, 2024</p>
                                    <p>Social Security number: XXX-XX-1234</p>
                                </div>
                            </div>
                            
                            <p style="margin-top: 15px;"><strong>Common formats:</strong></p>
                            <ul style="padding-left: 20px; margin-top: 10px;">
                                <li>CP### (e.g., CP14, CP501, CP2000)</li>
                                <li>LT## (e.g., LT11, LT16)</li>
                                <li>Letter #### (e.g., Letter 1058, Letter 3172)</li>
                            </ul>
                        </div>

                        <div style="display: flex; gap: 20px; margin-top: 25px; flex-wrap: wrap;">
                            <button class="option-btn" id="confirmYesBtn" data-code="${detectedCode}" style="flex: 1; min-width: 250px; padding: 25px 30px; font-size: 1.15em; border: 3px solid #28a745; background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); display: flex; align-items: center; gap: 15px;">
                                <span style="font-size: 2em; color: #28a745;">‚úì</span>
                                <span><strong style="font-size: 1.2em;">YES</strong> - That's correct</span>
                            </button>
                            <button class="option-btn" id="confirmNoBtn" data-code="${detectedCode}" style="flex: 1; min-width: 250px; padding: 25px 30px; font-size: 1.15em; border: 3px solid #dc3545; background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); display: flex; align-items: center; gap: 15px;">
                                <span style="font-size: 2em; color: #dc3545;">‚úó</span>
                                <span><strong style="font-size: 1.2em;">NO</strong> - That's not right</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners after DOM is updated
            setTimeout(function() {
                var yesBtn = document.getElementById('confirmYesBtn');
                var noBtn = document.getElementById('confirmNoBtn');
                if (yesBtn) {
                    yesBtn.addEventListener('click', function() {
                        confirmDetection(this.getAttribute('data-code'), true);
                    });
                }
                if (noBtn) {
                    noBtn.addEventListener('click', function() {
                        confirmDetection(this.getAttribute('data-code'), false);
                    });
                }
            }, 100);
        }

        function confirmDetection(detectedCode, isCorrect) {
            console.log('confirmDetection called:', detectedCode, isCorrect);
            try {
                if (isCorrect) {
                    // Proceed with detected code
                    noticeData = noticeDatabase[detectedCode];
                    console.log('noticeData set to:', noticeData);
                    if (!noticeData) {
                        alert('Error: Notice code not found in database. Please enter manually.');
                        goToStep(2);
                        return;
                    }
                    
                    // Restore loading spinner in step3
                    const step3 = document.getElementById('step3');
                    step3.innerHTML = `
                        <div class="loading">
                            <div class="spinner"></div>
                            <h3 style="color: #1e3c72;">Preparing Your Analysis...</h3>
                            <p style="margin-top: 10px; color: #666;">Just a moment...</p>
                        </div>
                    `;
                    
                    setTimeout(() => {
                        displayResults();
                        goToStep(4);
                    }, 1000);
                } else {
                    // Show manual input with emphasis
                    goToStep(2);
                    
                    // Add emphasis to manual input
                    const step2 = document.getElementById('step2');
                    const noticeInput = step2.querySelector('.question-box');
                    if (noticeInput) {
                        noticeInput.insertAdjacentHTML('afterbegin', `
                            <div class="alert-box" style="margin-bottom: 20px;">
                                <h4 style="margin-bottom: 10px;">We detected: ${detectedCode}</h4>
                                <p>But you indicated that's not correct. Please enter the correct notice number below.</p>
                            </div>
                        `);
                    }
                }
            } catch (error) {
                console.error('Error in confirmDetection:', error);
                alert('An error occurred. Please try again or enter your notice manually.');
                goToStep(2);
            }
        }

        function detectNoticeFromFile(file) {
            const filename = file.name.toUpperCase();
            
            for (let noticeCode in noticeDatabase) {
                if (filename.includes(noticeCode)) {
                    return noticeCode;
                }
            }
            
            // Simulate 70% detection rate for demo
            const commonNotices = ['CP14', 'CP501', 'CP2000', 'CP523'];
            return Math.random() > 0.3 ? commonNotices[Math.floor(Math.random() * commonNotices.length)] : null;
        }

        function selectRadio(element, value) {
            document.querySelectorAll('.radio-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            element.querySelector('input').checked = true;
        }

        function processManualInput() {
            const noticeNumber = document.getElementById('noticeNumber').value.trim().toUpperCase();
            const noticeType = document.querySelector('input[name="noticeType"]:checked')?.value;

            if (!noticeType) {
                alert('Please select what your notice is about.');
                return;
            }

            let matchedNotice = null;
            
            // Clean up notice number (remove spaces, handle "Letter" prefix)
            let cleanNoticeNumber = noticeNumber.replace(/\s+/g, '').replace(/^LETTER/i, 'Letter');
            
            // Try exact match first
            if (cleanNoticeNumber && noticeDatabase[cleanNoticeNumber]) {
                matchedNotice = noticeDatabase[cleanNoticeNumber];
            } 
            // Try without "CP" prefix variations
            else if (cleanNoticeNumber) {
                // Try adding CP if it's just numbers
                if (/^\d+[A-Z]?$/.test(cleanNoticeNumber)) {
                    if (noticeDatabase['CP' + cleanNoticeNumber]) {
                        matchedNotice = noticeDatabase['CP' + cleanNoticeNumber];
                    }
                }
                // Try Letter variations
                if (!matchedNotice && /^(LTR?|LETTER)\s*(\d+[A-Z]?)$/i.test(cleanNoticeNumber)) {
                    const letterNum = cleanNoticeNumber.replace(/^(LTR?|LETTER)\s*/i, '');
                    if (noticeDatabase['Letter' + letterNum]) {
                        matchedNotice = noticeDatabase['Letter' + letterNum];
                    }
                }
            }
            
            // If still no match but they entered a notice number, create a dynamic fallback
            if (!matchedNotice && cleanNoticeNumber) {
                matchedNotice = createFallbackNotice(cleanNoticeNumber, noticeType);
            }
            // Last resort: match by type
            else if (!matchedNotice) {
                matchedNotice = matchByType(noticeType);
            }

            if (matchedNotice) {
                noticeData = matchedNotice;
                goToStep(3);
                setTimeout(() => {
                    displayResults();
                    goToStep(4);
                }, 1500);
            } else {
                alert('We couldn\'t identify your specific notice. Please contact us for personalized help.');
            }
        }

        // Smart fallback for unrecognized notice numbers
        function createFallbackNotice(noticeNumber, noticeType) {
            // Format the notice number nicely
            let formattedNumber = noticeNumber;
            if (/^\d+[A-Z]?$/.test(noticeNumber)) {
                formattedNumber = 'CP' + noticeNumber;
            } else if (/^(LTR?|LETTER)?\s*\d+/i.test(noticeNumber)) {
                formattedNumber = 'Letter ' + noticeNumber.replace(/^(LTR?|LETTER)\s*/i, '');
            }
            
            // Create type-specific guidance
            const typeGuidance = {
                'balance-due': {
                    urgency: 'medium',
                    meaning: `Your notice (${formattedNumber}) indicates you have a balance due with the IRS. The IRS is requesting payment for unpaid taxes.`,
                    reason: 'You may have filed a return with a balance due, or the IRS made adjustments to your return resulting in additional tax owed.',
                    actions: [
                        'Review the notice carefully to understand the amount owed and due date',
                        'If you agree with the amount, pay in full or set up a payment plan',
                        'Request penalty abatement if you have a clean compliance history',
                        'If you disagree, respond in writing before the deadline with documentation'
                    ],
                    followUpQuestions: [
                        {
                            id: 'amount',
                            question: 'How much does the notice say you owe?',
                            type: 'amount',
                            options: ['Under $10,000', '$10,000 - $15,000', '$15,000 - $25,000', 'Over $25,000']
                        },
                        {
                            id: 'canPayFull',
                            question: 'Can you pay the full amount now?',
                            type: 'yesno'
                        },
                        {
                            id: 'hasBalancePenalties',
                            question: 'Does your notice show penalty charges?',
                            type: 'yesno'
                        },
                        {
                            id: 'penaltyFTF',
                            question: 'Failure to FILE Penalty (exact amount from notice):',
                            type: 'penaltyAmount',
                            showIf: (answers) => answers.hasBalancePenalties === 'yes'
                        },
                        {
                            id: 'penaltyFTP',
                            question: 'Failure to PAY Penalty (exact amount from notice):',
                            type: 'penaltyAmount',
                            showIf: (answers) => answers.hasBalancePenalties === 'yes'
                        },
                        {
                            id: 'penaltyOther',
                            question: 'Any OTHER Penalties (exact amount):',
                            type: 'penaltyAmount',
                            showIf: (answers) => answers.hasBalancePenalties === 'yes'
                        }
                    ],
                    needsProfessional: (answers) => answers.amount === 'Over $25,000'
                },
                'levy': {
                    urgency: 'critical',
                    meaning: `URGENT: Your notice (${formattedNumber}) appears to be related to IRS collection/levy action. The IRS may seize your assets if you don't act immediately.`,
                    reason: 'You have an unpaid balance and the IRS is moving toward enforced collection.',
                    actions: [
                        'DO NOT IGNORE - This requires immediate action',
                        'Call the IRS immediately at the number on your notice',
                        'Request a Collection Due Process hearing (Form 12153) if applicable',
                        'GET PROFESSIONAL HELP - Levy situations require expert intervention'
                    ],
                    followUpQuestions: [
                        {
                            id: 'amount',
                            question: 'Total amount you owe?',
                            type: 'amount',
                            options: ['Under $10,000', '$10,000 - $25,000', '$25,000 - $50,000', 'Over $50,000']
                        },
                        {
                            id: 'levyIssued',
                            question: 'Has the IRS already seized any assets (bank account, wages)?',
                            type: 'yesno'
                        }
                    ],
                    needsProfessional: () => true
                },
                'payment-plan': {
                    urgency: 'high',
                    meaning: `Your notice (${formattedNumber}) relates to your IRS payment plan/installment agreement. There may be an issue with your agreement.`,
                    reason: 'This could be a default notice, modification, or other issue with your existing payment arrangement.',
                    actions: [
                        'Review the specific issue mentioned in the notice',
                        'If you missed a payment, make it immediately',
                        'Call the IRS to discuss options for keeping your agreement active',
                        'Don\'t ignore this - payment plan issues can escalate quickly'
                    ],
                    followUpQuestions: [
                        {
                            id: 'planIssue',
                            question: 'What issue does the notice mention?',
                            type: 'radio',
                            options: ['Missed payment(s)', 'Agreement termination', 'Payment amount change', 'Other/not sure']
                        },
                        {
                            id: 'canCatchUp',
                            question: 'Can you catch up on any missed payments?',
                            type: 'yesno'
                        }
                    ],
                    needsProfessional: (answers) => answers.planIssue === 'Agreement termination' || answers.canCatchUp === 'no'
                },
                'changes': {
                    urgency: 'medium',
                    meaning: `Your notice (${formattedNumber}) indicates the IRS has made or is proposing changes to your tax return.`,
                    reason: 'The IRS found discrepancies, errors, or unreported income on your return.',
                    actions: [
                        'Compare the proposed changes to your original tax return',
                        'Gather documentation to support your position if you disagree',
                        'Respond by the deadline shown on your notice',
                        'If you agree with the changes, follow the instructions to accept them'
                    ],
                    followUpQuestions: [
                        {
                            id: 'proposedAmount',
                            question: 'How much additional tax are they proposing (if any)?',
                            type: 'amount',
                            options: ['No additional tax / refund due', 'Under $5,000', '$5,000 - $15,000', 'Over $15,000']
                        },
                        {
                            id: 'agreeWithChanges',
                            question: 'Do you agree with the IRS\'s changes?',
                            type: 'radio',
                            options: ['Yes, they\'re correct', 'Partially agree', 'No, I disagree', 'Not sure']
                        }
                    ],
                    needsProfessional: (answers) => 
                        answers.proposedAmount === 'Over $15,000' ||
                        answers.agreeWithChanges === 'No, I disagree' ||
                        answers.agreeWithChanges === 'Not sure'
                }
            };
            
            const guidance = typeGuidance[noticeType] || typeGuidance['balance-due'];
            
            return {
                type: formattedNumber,
                name: 'IRS Notice',
                urgency: guidance.urgency,
                meaning: guidance.meaning,
                reason: guidance.reason,
                deadline: 'Check your notice for the specific deadline',
                hasDeadline: true,
                actions: guidance.actions,
                followUpQuestions: guidance.followUpQuestions,
                needsProfessional: guidance.needsProfessional
            };
        }

        function matchByType(type) {
            const typeMap = {
                'balance-due': 'CP14',
                'levy': 'CP90',
                'payment-plan': 'CP523',
                'changes': 'CP11'  // Changed from CP2000 to CP11 as primary "changes" notice
            };
            
            const noticeCode = typeMap[type];
            return noticeCode ? noticeDatabase[noticeCode] : noticeDatabase['CP14'];
        }

        function displayResults() {
            console.log('displayResults called, noticeData:', noticeData);
            try {
                if (!noticeData || !noticeData.type) {
                    console.error('noticeData is empty or invalid');
                    alert('Error loading notice data. Please try again.');
                    goToStep(1);
                    return;
                }
                
                document.getElementById('noticeType').textContent = noticeData.type + ': ' + noticeData.name;
            
            const badge = document.getElementById('urgencyBadge');
            badge.textContent = noticeData.urgency.toUpperCase();
            badge.className = 'urgency-badge urgency-' + noticeData.urgency;

            document.getElementById('noticeMeaning').textContent = noticeData.meaning;
            document.getElementById('noticeReason').textContent = noticeData.reason;

            if (noticeData.hasDeadline) {
                document.getElementById('deadlineSection').style.display = 'block';
                document.getElementById('deadlineText').textContent = 
                    `You must respond within ${noticeData.deadline}. Missing this deadline can result in serious consequences.`;
            }

            if (noticeData.followUpQuestions && noticeData.followUpQuestions.length > 0) {
                displayFollowUpQuestions();
            }
        }

        function displayFollowUpQuestions() {
            document.getElementById('followUpQuestions').style.display = 'block';
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';

            // Track which questions have conditional display
            let questionIndex = 0;
            
            noticeData.followUpQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-box';
                questionDiv.style.marginBottom = '20px';
                questionDiv.id = `questionBox_${q.id}`;
                
                // Check if this question has a showIf condition
                if (q.showIf) {
                    questionDiv.style.display = 'none';
                    questionDiv.dataset.showIf = 'true';
                    questionDiv.dataset.questionId = q.id;
                }

                let inputHTML = '';
                
                // NEW: Use calculator input for amount questions
                if (q.type === 'amount' && q.id === 'amount') {
                    inputHTML = `
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 15px; margin-top: 15px;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <span style="color: white; font-size: 2em;">$</span>
                                <input type="number" id="balanceInput" class="text-input" 
                                       placeholder="Enter exact amount from notice" 
                                       style="font-size: 1.5em; padding: 15px; flex: 1; margin: 0;"
                                       onchange="updateBalanceCategory(this.value)">
                            </div>
                            <p style="color: rgba(255,255,255,0.9); margin-top: 15px; font-size: 0.95em; text-align: center;">
                                üí° Enter the TOTAL amount due from your notice (including penalties & interest)
                            </p>
                            <input type="hidden" name="q${index}" id="q${index}_hidden" value="">
                        </div>
                    `;
                } else if (q.type === 'penaltyAmount') {
                    // Exact penalty amount input
                    inputHTML = `
                        <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                            <span style="font-size: 1.3em; color: #667eea; font-weight: bold;">$</span>
                            <input type="number" class="text-input" id="q${index}" 
                                   placeholder="0" 
                                   style="font-size: 1.2em; padding: 12px; flex: 1; max-width: 200px; margin: 0;"
                                   data-penalty-type="${q.id}"
                                   value="0"
                                   min="0"
                                   onchange="storePenaltyAmount('${q.id}', this.value)">
                            <span style="color: #666; font-size: 0.9em;">(enter 0 if none)</span>
                        </div>
                    `;
                } else if (q.type === 'amount' || q.type === 'radio') {
                    inputHTML = q.options.map(opt => 
                        `<div class="radio-option" onclick="selectRadioAndCheck(this, '${opt}', '${q.id}')">
                            <input type="radio" name="q${index}" value="${opt}">
                            <label>${opt}</label>
                        </div>`
                    ).join('');
                } else if (q.type === 'yesno') {
                    inputHTML = `
                        <div class="radio-option" onclick="selectRadioAndCheck(this, 'yes', '${q.id}')">
                            <input type="radio" name="q${index}" value="yes">
                            <label>Yes</label>
                        </div>
                        <div class="radio-option" onclick="selectRadioAndCheck(this, 'no', '${q.id}')">
                            <input type="radio" name="q${index}" value="no">
                            <label>No</label>
                        </div>
                    `;
                } else if (q.type === 'text') {
                    inputHTML = `<input type="text" class="text-input" id="q${index}" placeholder="${q.placeholder || ''}">`;
                }

                questionDiv.innerHTML = `
                    <div class="question">${q.question}</div>
                    ${inputHTML}
                `;

                container.appendChild(questionDiv);
                questionIndex++;
            });

            document.getElementById('showResourcesBtn').onclick = processFollowUpAnswers;
        }

        // Helper to update balance category from calculator input
        function updateBalanceCategory(value) {
            const amount = parseFloat(value);
            let category = '';
            
            if (amount < 10000) category = 'Under $10,000';
            else if (amount < 15000) category = '$10,000 - $15,000';
            else if (amount < 25000) category = '$15,000 - $25,000';
            else category = 'Over $25,000';
            
            // Store the actual amount and the category
            const hiddenInput = document.querySelector('input[id$="_hidden"]');
            if (hiddenInput) {
                hiddenInput.value = category;
            }
            
            // Store exact amount for calculations
            window.exactBalance = amount;
        }

        // Store exact penalty amounts
        window.exactPenalties = window.exactPenalties || {};
        function storePenaltyAmount(penaltyType, value) {
            window.exactPenalties[penaltyType] = parseFloat(value) || 0;
        }

        // Enhanced selectRadio that also checks for conditional questions
        function selectRadioAndCheck(element, value, questionId) {
            selectRadio(element, value);
            
            // Check if this answer should reveal conditional questions
            if (questionId === 'hasBalancePenalties') {
                const penaltyQuestions = document.querySelectorAll('[data-show-if="true"]');
                penaltyQuestions.forEach(q => {
                    if (value === 'yes') {
                        q.style.display = 'block';
                    } else {
                        q.style.display = 'none';
                        // Reset penalty amounts to 0 when hiding
                        window.exactPenalties = {};
                    }
                });
            }
        }

        function processFollowUpAnswers() {
            followUpAnswers = {};
            
            // Get exact balance if entered
            if (window.exactBalance) {
                followUpAnswers.exactBalance = window.exactBalance;
            }
            
            // Copy exact penalty amounts from window storage
            if (window.exactPenalties && Object.keys(window.exactPenalties).length > 0) {
                Object.assign(followUpAnswers, window.exactPenalties);
            }
            
            noticeData.followUpQuestions.forEach((q, index) => {
                // Skip hidden conditional questions that weren't answered
                const questionBox = document.getElementById(`questionBox_${q.id}`);
                if (questionBox && questionBox.style.display === 'none') {
                    followUpAnswers[q.id] = '$0'; // Default for hidden penalty questions
                    return;
                }
                
                if (q.type === 'text') {
                    followUpAnswers[q.id] = document.getElementById(`q${index}`).value;
                } else if (q.type === 'amount' && q.id === 'amount') {
                    // Get from hidden input for amount calculator
                    const hiddenInput = document.querySelector('input[id$="_hidden"]');
                    followUpAnswers[q.id] = hiddenInput ? hiddenInput.value : null;
                    
                    // Validate that amount was entered
                    if (!window.exactBalance || window.exactBalance <= 0) {
                        alert('Please enter your total balance amount.');
                        return;
                    }
                } else if (q.type === 'penaltyAmount') {
                    // Penalty amounts are already stored in window.exactPenalties via storePenaltyAmount
                    // Just ensure we have the value in followUpAnswers
                    const inputElement = document.getElementById(`q${index}`);
                    if (inputElement) {
                        const value = parseFloat(inputElement.value) || 0;
                        followUpAnswers[q.id] = value;
                        // Also ensure window.exactPenalties is updated
                        window.exactPenalties[q.id] = value;
                    }
                } else {
                    const selected = document.querySelector(`input[name="q${index}"]:checked`);
                    followUpAnswers[q.id] = selected ? selected.value : null;
                }
            });

            // Check required questions are answered
            const requiredAnswers = noticeData.followUpQuestions
                .filter(q => !q.showIf) // Only check non-conditional questions
                .map(q => followUpAnswers[q.id]);
            
            const allAnswered = requiredAnswers.every(v => v !== null && v !== '');
            if (!allAnswered) {
                alert('Please answer all questions to get personalized recommendations.');
                return;
            }

            // Check if user has penalties - if so, show comparison first
            if (followUpAnswers.hasBalancePenalties === 'yes') {
                goToStep(5);
                const container = document.getElementById('resourcesContainer');
                showPaymentComparison(container, followUpAnswers);
            } else {
                showResources();
            }
        }

        function showResources() {
            goToStep(5);
            
            const container = document.getElementById('resourcesContainer');
            container.innerHTML = '';

            const noticeType = noticeData.type;
            const answers = followUpAnswers;

            // Generate print checklist
            generatePrintChecklist(noticeType, answers);

            // Balance due notices that should show payment plan section
            const balanceDueNotices = ['CP14', 'CP501', 'CP503', 'CP504', 'CP504B', 'CP161', 'CP23', 'CP49'];
            
            // Check if this is a balance due notice OR a fallback notice with balance-due type
            const isBalanceDueNotice = balanceDueNotices.includes(noticeType) || 
                                       (noticeData.name === 'IRS Notice' && answers.hasBalancePenalties !== undefined);

            if (isBalanceDueNotice && answers.amount !== 'Over $25,000') {
                addPaymentPlanSection(container, answers);
                
                if (answers.hasBalancePenalties === 'yes') {
                    addPenaltyAbatementLink(container);
                }
            }

            if (noticeType === 'CP11') {
                // CP11 shows payment plan if they agree with changes, or dispute instructions if they don't
                if (answers.agreeWithChanges === 'Yes, they are correct') {
                    addPaymentPlanSection(container, answers);
                    if (answers.hasBalancePenalties === 'yes') {
                        addPenaltyAbatementLink(container);
                    }
                } else {
                    addCP11DisputeSection(container, answers);
                }
            }

            // Good news notices
            if (['CP12', 'CP13', 'CP24'].includes(noticeType)) {
                addGoodNewsSection(container, noticeType, answers);
            }

            if (noticeType === 'CP2000' || noticeType === 'CP2051') {
                addCP2000ResponseSection(container, answers);
            }

            if (noticeType === 'CP523') {
                addReinstatementSection(container, answers);
            }

            if (['CP90', 'CP91', 'CP297', 'CP298', 'CP504B', 'LT11', 'Letter1058'].includes(noticeType)) {
                addEmergencyHelpSection(container);
            }

            if (noticeType === 'CP59') {
                addUnfiledReturnSection(container, answers);
            }

            if (['Letter525', 'Letter531'].includes(noticeType)) {
                addAuditResponseSection(container, noticeType, answers);
            }

            if (noticeType === 'Letter12C') {
                addInfoRequestSection(container, answers);
            }

            // Add collapsible resource sections - FAQ only
            addFAQSection(container);

            if (noticeData.needsProfessional && noticeData.needsProfessional(followUpAnswers)) {
                document.getElementById('professionalHelpSection').style.display = 'block';
                document.getElementById('professionalHelpReason').textContent = getProfessionalHelpReason();
            }
        }

        // FAQ Section
        function addFAQSection(container) {
            const section = createExpandableSection(
                '‚ùì Frequently Asked Questions',
                'Common questions about IRS payment plans',
                `
                    <div style="padding: 20px;">
                        <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #667eea;">
                            <h4 style="color: #1e3c72; margin-bottom: 10px;">What's the setup fee?</h4>
                            <p style="color: #666;">$31 for online application with direct debit. Phone/mail is $107-$225. Always use online!</p>
                        </div>
                        
                        <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #667eea;">
                            <h4 style="color: #1e3c72; margin-bottom: 10px;">Can I pay it off early?</h4>
                            <p style="color: #666;">Yes! No prepayment penalty. Pay extra anytime to reduce interest and finish faster.</p>
                        </div>
                        
                        <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #667eea;">
                            <h4 style="color: #1e3c72; margin-bottom: 10px;">What if I miss a payment?</h4>
                            <p style="color: #666;">Make it up immediately! One missed payment triggers a 30-day warning. Two can default your agreement and restart collection actions.</p>
                        </div>
                        
                        <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #667eea;">
                            <h4 style="color: #1e3c72; margin-bottom: 10px;">Do I still need to file future returns?</h4>
                            <p style="color: #666;">YES! You must file on time every year, even if you can't pay. Late filing = automatic default of your payment plan.</p>
                        </div>
                        
                        <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #667eea;">
                            <h4 style="color: #1e3c72; margin-bottom: 10px;">What if I owe new taxes next year?</h4>
                            <p style="color: #666;">Small amounts (under $1,000-$2,000) usually get added to your existing plan. Larger amounts may require renegotiation. Adjust your withholding NOW to avoid this.</p>
                        </div>
                        
                        <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #667eea;">
                            <h4 style="color: #1e3c72; margin-bottom: 10px;">Will this affect my credit?</h4>
                            <p style="color: #666;">A payment plan itself doesn't report to credit bureaus. However, if the IRS files a tax lien (usually for debts over $10,000 not in a payment plan), that can affect credit.</p>
                        </div>
                        
                        <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #667eea;">
                            <h4 style="color: #1e3c72; margin-bottom: 10px;">What documents do I need?</h4>
                            <p style="color: #666;">SSN, date of birth, address (matching IRS records), bank routing & account numbers, and your prior year tax return for security questions.</p>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #e8f4f8; border-radius: 8px; border-left: 3px solid #28a745;">
                            <h4 style="color: #1e3c72; margin-bottom: 10px;">Can I get a refund?</h4>
                            <p style="color: #666;">No - but here's something better: If you follow the guide, submit everything correctly as instructed, and the IRS rejects your application due to an error in the guidance (not your ineligibility), we'll work with you until your payment plan is approved. We don't disappear - we see it through.</p>
                        </div>
                    </div>
                `,
                false
            );
            container.appendChild(section);
        }

        // Playbook download section
        function addPlaybookSection(container) {
            const section = createExpandableSection(
                'üìò IRS Payment Plan Playbook',
                '120+ page DIY guide with step-by-step instructions',
                `
                    <div style="padding: 20px; text-align: center;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 15px; color: white;">
                            <div style="font-size: 3em; margin-bottom: 15px;">üìò</div>
                            <h3 style="color: white; margin-bottom: 15px;">The Complete DIY Payment Plan Guide</h3>
                            <p style="margin-bottom: 20px; opacity: 0.95;">Step-by-step instructions with screenshots, troubleshooting tips, compliance strategies, and everything you need to resolve your IRS debt.</p>
                            <button class="btn btn-primary" onclick="window.open('https://drive.google.com/file/d/1tdJ9ahA53UEzE__3kYjGeIjC4SV6Cizg/view?usp=sharing', '_blank')" style="background: white; color: #667eea; padding: 15px 30px; font-size: 1.1em;">
                                üì• Download Playbook (PDF)
                            </button>
                        </div>
                    </div>
                `,
                false
            );
            container.appendChild(section);
        }

        // Good news section for refund/no balance notices
        function addGoodNewsSection(container, noticeType, answers) {
            const section = createExpandableSection(
                'üéâ Good News - No Action Required',
                'Review the changes and what to expect',
                `
                    <div style="padding: 20px;">
                        <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; text-align: center;">
                            <div style="font-size: 3em; margin-bottom: 10px;">‚úÖ</div>
                            <h3 style="color: white; margin-bottom: 10px;">No Payment Required!</h3>
                            <p style="font-size: 1.1em;">The IRS has made changes that resulted in ${noticeType === 'CP12' || noticeType === 'CP24' ? 'a refund or credit' : 'no balance due'}.</p>
                        </div>
                        
                        <div style="background: #e8f4f8; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 style="color: #1e3c72; margin-bottom: 15px;">What to Do:</h4>
                            <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                                <li>Review the notice to understand what changes were made</li>
                                <li>Compare to your original return to verify accuracy</li>
                                ${noticeType === 'CP12' || noticeType === 'CP24' ? '<li>Your refund should arrive within 4-6 weeks</li>' : ''}
                                <li>If you agree with the changes, no further action needed</li>
                                <li>If you disagree, contact the IRS within 60 days</li>
                                <li>Keep this notice with your tax records</li>
                            </ul>
                        </div>
                        
                        ${answers.agreeWithChanges === 'No, I think they made an error' || answers.agreeWithChanges === 'No, I disagree' ? `
                        <div style="background: #fff3cd; padding: 20px; border-radius: 10px;">
                            <h4 style="color: #856404; margin-bottom: 10px;">‚ö†Ô∏è You Indicated Disagreement</h4>
                            <p>If you believe the IRS made an error, you should contact them to dispute the changes. Gather documentation supporting your original return before calling.</p>
                            <p style="margin-top: 10px;"><strong>IRS Phone:</strong> 1-800-829-8374</p>
                        </div>
                        ` : ''}
                    </div>
                `,
                true
            );
            container.appendChild(section);
        }

        // Unfiled return section for CP59
        function addUnfiledReturnSection(container, answers) {
            const section = createExpandableSection(
                'üìÑ File Your Missing Tax Return',
                'Steps to file your unfiled return and resolve this notice',
                `
                    <div style="padding: 20px;">
                        <div style="background: #f8d7da; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 style="color: #721c24; margin-bottom: 10px;">‚ö†Ô∏è Important Warning</h4>
                            <p>If you don't file the return, the IRS may file a <strong>Substitute for Return (SFR)</strong> for you. SFRs typically show much higher taxes because the IRS won't include deductions or credits you're entitled to.</p>
                        </div>
                        
                        <div style="background: #e8f4f8; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 style="color: #1e3c72; margin-bottom: 15px;">Your Next Steps:</h4>
                            
                            ${answers.didFile === 'Yes, I filed it' ? `
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h5 style="color: #28a745;">‚úÖ You Already Filed</h5>
                                <p>Send proof to the IRS that you filed:</p>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>Copy of your filed return</li>
                                    <li>Certified mail receipt (if you have it)</li>
                                    <li>E-file confirmation (if filed electronically)</li>
                                </ul>
                                <p>Mail to the address on your notice using certified mail with return receipt.</p>
                            </div>
                            ` : `
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h5 style="color: #dc3545;">üìù You Need to File</h5>
                                <ol style="margin: 10px 0; padding-left: 20px; line-height: 1.8;">
                                    <li>Gather all income documents (W-2s, 1099s) for that year</li>
                                    <li>If you don't have them, request IRS transcripts at <a href="https://www.irs.gov/individuals/get-transcript" target="_blank">irs.gov/get-transcript</a></li>
                                    <li>Prepare and file the return as soon as possible</li>
                                    <li>Consider professional help if you're missing records</li>
                                </ol>
                            </div>
                            `}
                            
                            ${answers.yearsUnfiled === 'Yes, 3+ years' ? `
                            <div style="background: #fff3cd; padding: 15px; border-radius: 8px;">
                                <h5 style="color: #856404;">‚ö†Ô∏è Multiple Unfiled Years</h5>
                                <p>You indicated you have 3+ years of unfiled returns. This is a complex situation that typically requires professional help to:</p>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>Determine which years must be filed</li>
                                    <li>Reconstruct records from IRS transcripts</li>
                                    <li>File returns in the correct sequence</li>
                                    <li>Negotiate penalty abatement</li>
                                </ul>
                                <button class="btn btn-danger" onclick="window.open('https://calendly.com/shontathomas/60-min-strategy-call', '_blank')" style="margin-top: 10px;">
                                    Get Help with Multiple Unfiled Returns
                                </button>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `,
                true
            );
            container.appendChild(section);
        }

        // Audit response section for Letter 525 and Letter 531
        function addAuditResponseSection(container, noticeType, answers) {
            const is90Day = noticeType === 'Letter531';
            const section = createExpandableSection(
                is90Day ? '‚öñÔ∏è Notice of Deficiency - Your Options' : 'üìã Examination Report - How to Respond',
                is90Day ? 'Critical 90-day deadline to petition Tax Court' : '30 days to agree, appeal, or request conference',
                `
                    <div style="padding: 20px;">
                        ${is90Day ? `
                        <div style="background: #f8d7da; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 style="color: #721c24; margin-bottom: 10px;">üö® CRITICAL: 90-Day Deadline</h4>
                            <p>This is a <strong>legal notice</strong>. You have exactly 90 days from the date on the letter to file a petition with the US Tax Court. If you miss this deadline, you <strong>lose your right</strong> to dispute the deficiency in court.</p>
                            <p style="margin-top: 10px; font-weight: bold;">Deadline from notice: Check your letter carefully!</p>
                        </div>
                        ` : `
                        <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 style="color: #856404; margin-bottom: 10px;">‚è∞ 30-Day Response Deadline</h4>
                            <p>You have 30 days to respond to this examination report. You can agree, partially agree, or request an appeal.</p>
                        </div>
                        `}
                        
                        <div style="background: #e8f4f8; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 style="color: #1e3c72; margin-bottom: 15px;">Your Options:</h4>
                            
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h5 style="color: #28a745;">Option 1: Agree with the Changes</h5>
                                <p>Sign the agreement form included with your letter and return it by the deadline. The additional tax will be assessed.</p>
                            </div>
                            
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h5 style="color: #667eea;">Option 2: Request a Conference</h5>
                                <p>You can request a meeting with the examiner's supervisor to discuss the findings before making a decision.</p>
                            </div>
                            
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h5 style="color: #ff9800;">Option 3: Appeal to IRS Appeals Office</h5>
                                <p>Request an appeal hearing with the IRS Independent Office of Appeals. This is an informal process to resolve disputes.</p>
                            </div>
                            
                            ${is90Day ? `
                            <div style="background: white; padding: 15px; border-radius: 8px;">
                                <h5 style="color: #dc3545;">Option 4: Petition Tax Court</h5>
                                <p>File a petition with the US Tax Court within 90 days. This is a formal legal proceeding and professional representation is strongly recommended.</p>
                            </div>
                            ` : ''}
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px;">
                            <h4 style="color: white; margin-bottom: 10px;">üí° Professional Help Recommended</h4>
                            <p>Audit disputes and Tax Court petitions are complex. Professional representation significantly improves your chances of a favorable outcome.</p>
                            <button class="btn btn-primary" onclick="window.open('https://calendly.com/shontathomas/60-min-strategy-call', '_blank')" style="background: white; color: #667eea; margin-top: 15px;">
                                Schedule Audit Defense Strategy Call
                            </button>
                        </div>
                    </div>
                `,
                true
            );
            container.appendChild(section);
        }

        // Info request section for Letter 12C
        function addInfoRequestSection(container, answers) {
            const section = createExpandableSection(
                'üì® Respond to Information Request',
                'How to provide the documents the IRS is requesting',
                `
                    <div style="padding: 20px;">
                        <div style="background: #e8f4f8; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 style="color: #1e3c72; margin-bottom: 15px;">Steps to Respond:</h4>
                            <ol style="margin: 0; padding-left: 20px; line-height: 1.8;">
                                <li>Read the letter carefully to identify exactly what documents they need</li>
                                <li>Gather the requested documents (W-2s, 1099s, receipts, etc.)</li>
                                <li>Make copies - never send originals</li>
                                <li>Include the response form that came with your letter</li>
                                <li>Write your SSN and tax year on every page</li>
                                <li>Mail using certified mail with return receipt</li>
                                <li>Keep copies of everything you send</li>
                            </ol>
                        </div>
                        
                        ${answers.hasDocuments === 'No, I need to get them' || answers.hasDocuments === 'I have some of it' ? `
                        <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 style="color: #856404; margin-bottom: 10px;">üìÇ Need to Get Documents?</h4>
                            <p><strong>If you're missing W-2s or 1099s:</strong></p>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>Request from your employer/payer</li>
                                <li>Get IRS Wage & Income transcript at <a href="https://www.irs.gov/individuals/get-transcript" target="_blank">irs.gov/get-transcript</a></li>
                            </ul>
                            <p style="margin-top: 10px;"><strong>If you need more time:</strong> Call the number on your letter before the deadline to request an extension.</p>
                        </div>
                        ` : ''}
                        
                        <div style="background: white; padding: 15px; border: 2px solid #667eea; border-radius: 10px;">
                            <h4 style="color: #1e3c72; margin-bottom: 10px;">üì¨ Where to Mail Your Response</h4>
                            <p>Mail to the address shown on your Letter 12C. Use certified mail with return receipt for proof of timely response.</p>
                        </div>
                    </div>
                `,
                true
            );
            container.appendChild(section);
        }

        // Next steps tracker section
        function addNextStepsTracker(container) {
            const section = createExpandableSection(
                'üìä Track Your Progress',
                'Download your compliance tracker spreadsheet',
                `
                    <div style="padding: 20px;">
                        <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 25px; border-radius: 15px; text-align: center;">
                            <div style="font-size: 2.5em; margin-bottom: 15px;">üìã</div>
                            <h3 style="color: white; margin-bottom: 15px;">Stay Organized with Your Compliance Tracker</h3>
                            <p style="font-size: 1.05em; margin-bottom: 20px; opacity: 0.95;">Track your payments, deadlines, and progress toward resolving your IRS issue.</p>
                            <button class="btn btn-primary" onclick="window.open('https://docs.google.com/spreadsheets/d/1X_bpT6DNsrOjE602ScYUI_-2FGsD11mC/edit?usp=sharing&ouid=108502135261712027699&rtpof=true&sd=true', '_blank')" style="background: white; color: #28a745; padding: 15px 30px; font-size: 1.1em;">
                                üì• Download Compliance Tracker
                            </button>
                        </div>
                    </div>
                `,
                false
            );
            container.appendChild(section);
        }

        function generatePrintChecklist(noticeType, answers) {
            // Remove existing checklist if present
            const existing = document.getElementById('printChecklist');
            if (existing) existing.remove();

            // Create checklist container
            const checklist = document.createElement('div');
            checklist.id = 'printChecklist';
            checklist.className = 'print-checklist';
            checklist.style.pageBreakBefore = 'always';

            let checklistHTML = `
                <div style="padding: 30px; font-family: Arial, sans-serif;">
                    <div style="text-align: center; border-bottom: 3px solid #1e3c72; padding-bottom: 20px; margin-bottom: 30px;">
                        <h1 style="color: #1e3c72; margin-bottom: 10px;">My IRS Resolution Action Plan</h1>
                        <p style="font-size: 1.1em; color: #666;">Notice: ${noticeData.type} - ${noticeData.name}</p>
                        <p style="font-size: 0.95em; color: #666;">Generated: ${new Date().toLocaleDateString()}</p>
                    </div>

                    <div style="background: #f8f9fa; padding: 20px; border-left: 4px solid #dc3545; margin-bottom: 30px;">
                        <h3 style="color: #721c24; margin-bottom: 10px;">‚è∞ CRITICAL DEADLINE</h3>
                        <p style="font-size: 1.1em; margin: 0;">${noticeData.hasDeadline ? `Response required within ${noticeData.deadline}` : 'Take action as soon as possible'}</p>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h2 style="color: #1e3c72; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">üìã My Action Checklist</h2>
            `;

            // Build checklist based on notice type
            if (['CP14', 'CP501'].includes(noticeType)) {
                checklistHTML += `
                    <div style="margin: 20px 0;">
                        <h3 style="color: #1e3c72; margin-bottom: 15px;">Setting Up Payment Plan:</h3>
                        <div style="padding-left: 20px;">
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Get IRS account transcript from www.irs.gov/account</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Verify balance: $${answers.amount || '_______'}</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Gather bank account info (routing & account number)</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Have prior year tax return ready for security questions</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Calculate monthly payment I can afford: $_______</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Go to www.irs.gov/payments and click "Apply for Payment Plan"</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Complete online application (use direct debit for $31 fee)</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Choose payment date 2-3 days after I receive income</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Triple-check bank routing & account numbers</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Save confirmation number: _______</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Set up calendar reminders 3 days before each payment</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Set up low-balance alerts on bank account</p>
                        </div>
                    </div>
                `;

                if (answers.hasBalancePenalties === 'yes') {
                    checklistHTML += `
                        <div style="margin: 30px 0; padding: 20px; background: #e8f4f8; border-radius: 10px;">
                            <h3 style="color: #1e3c72; margin-bottom: 15px;">üí∞ Penalty Abatement (Could Save 25-47%):</h3>
                            <div style="padding-left: 20px;">
                                <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Complete penalty abatement assessment at: PENALTY_ABATEMENT_SALES_PAGE_URL_PLACEHOLDER</p>
                                <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Determine if I qualify for First-Time Penalty Abatement</p>
                                <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> OR gather documentation for Reasonable Cause</p>
                                <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Submit penalty abatement request</p>
                            </div>
                        </div>
                    `;
                }

                if (answers.amount === '$15,000 - $25,000' || answers.amount === 'Over $25,000') {
                    checklistHTML += `
                        <div style="margin: 30px 0; padding: 20px; background: #fff3cd; border-radius: 10px;">
                            <h3 style="color: #856404; margin-bottom: 15px;">üéØ Consider Strategic Options:</h3>
                            <p style="margin-bottom: 15px;">My balance may qualify for reduction beyond standard payment plans:</p>
                            <div style="padding-left: 20px;">
                                <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Schedule evaluation call to explore Offer in Compromise</p>
                                <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Ask about Partial Payment Plan (pay less than full balance)</p>
                                <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Check if I qualify for Currently Not Collectible status</p>
                                <p style="margin: 10px 0;">Call: https://calendly.com/shontathomas/60-min-strategy-call</p>
                            </div>
                        </div>
                    `;
                }
            }

            if (noticeType === 'CP2000') {
                checklistHTML += `
                    <div style="margin: 20px 0;">
                        <h3 style="color: #1e3c72; margin-bottom: 15px;">Responding to CP2000:</h3>
                        <div style="padding-left: 20px;">
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Pull out my original tax return for comparison</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Compare notice to my return line-by-line</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Decide: Agree / Disagree / Partially Agree: ${answers.agreeWithChanges || '_______'}</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Gather supporting documentation (W-2s, 1099s, receipts, statements)</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Write response letter using template</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Make copies of ALL documents (never send originals)</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Complete CP2000 response form from notice</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Mail via Certified Mail with Return Receipt ($8 at post office)</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Mail to address on notice at least 7-10 days before deadline</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Keep certified mail receipt: Tracking # _______</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Save copies of everything mailed</p>
                        </div>
                    </div>
                `;

                if (answers.proposedAmount === 'Over $10,000') {
                    checklistHTML += `
                        <div style="margin: 30px 0; padding: 20px; background: #fff3cd; border-radius: 10px;">
                            <h3 style="color: #856404; margin-bottom: 10px;">‚ö†Ô∏è Consider Professional Help:</h3>
                            <p>CP2000 over $10,000 benefits from professional representation</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Schedule strategy call for document review</p>
                        </div>
                    `;
                }
            }

            if (noticeType === 'CP523') {
                checklistHTML += `
                    <div style="margin: 20px 0;">
                        <h3 style="color: #1e3c72; margin-bottom: 15px;">Reinstating Payment Plan:</h3>
                        <div style="padding-left: 20px;">
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Calculate total missed payments: $_______</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Add next scheduled payment: $_______</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Total to pay NOW: $_______</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Pay via IRS Direct Pay (www.irs.gov/directpay)</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Save confirmation numbers: _______</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Call number on CP523 notice within 24-48 hours</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Request reinstatement and get rep name/ID</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Rep Name: _______ ID: _______</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Write reinstatement letter using template</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Mail via Certified Mail within 2-3 days</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Set up payment reminders and bank alerts</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Create buffer savings for IRS payments</p>
                        </div>
                    </div>
                `;

                if (answers.canCatchUp === 'no') {
                    checklistHTML += `
                        <div style="margin: 30px 0; padding: 20px; background: #f8d7da; border-radius: 10px;">
                            <h3 style="color: #721c24; margin-bottom: 10px;">üö® Professional Help Needed:</h3>
                            <p>Cannot catch up on payments - need to negotiate modified terms</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Schedule emergency strategy call immediately</p>
                        </div>
                    `;
                }
            }

            if (noticeType === 'CP90') {
                checklistHTML += `
                    <div style="margin: 20px 0; padding: 20px; background: #f8d7da; border-radius: 10px;">
                        <h3 style="color: #721c24; margin-bottom: 15px;">üö® EMERGENCY - Levy Notice:</h3>
                        <div style="padding-left: 20px;">
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Call the number on notice IMMEDIATELY</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Schedule emergency strategy call within 24 hours</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Discuss Collection Due Process hearing (Form 12153)</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Explore Currently Not Collectible status</p>
                            <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Consider Offer in Compromise</p>
                            <p style="margin: 10px 0;"><strong>DO NOT DELAY - IRS can seize assets at any time</strong></p>
                        </div>
                    </div>
                `;
            }

            // Always add ongoing compliance
            checklistHTML += `
                <div style="margin: 30px 0; page-break-inside: avoid;">
                    <h2 style="color: #1e3c72; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">‚úÖ Ongoing Compliance (Required):</h2>
                    <div style="padding-left: 20px;">
                        <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Make every payment on time - set reminders 3 days early</p>
                        <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> File all future tax returns by April 15 (even if can't pay)</p>
                        <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Adjust W-4 withholding to prevent future tax debt</p>
                        <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> OR make quarterly estimated payments if self-employed</p>
                        <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Update IRS if I move or change bank accounts (30 days notice)</p>
                        <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Track all payments - verify each one hits my account</p>
                        <p style="margin: 10px 0;"><input type="checkbox" style="margin-right: 10px;"> Request account transcript quarterly to verify balance</p>
                    </div>
                </div>

                <div style="margin: 30px 0; page-break-inside: avoid;">
                    <h2 style="color: #1e3c72; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">üìû Important Contacts:</h2>
                    <div style="padding-left: 20px;">
                        <p style="margin: 10px 0;"><strong>IRS Payments:</strong> www.irs.gov/payments</p>
                        <p style="margin: 10px 0;"><strong>IRS Direct Pay:</strong> www.irs.gov/directpay</p>
                        <p style="margin: 10px 0;"><strong>IRS Phone:</strong> 1-800-829-1040 (Mon-Fri, 7am-7pm)</p>
                        <p style="margin: 10px 0;"><strong>IRS Account:</strong> www.irs.gov/account</p>
                        <p style="margin: 10px 0;"><strong>Thomas Tax Strategists:</strong> https://calendly.com/shontathomas/60-min-strategy-call</p>
                    </div>
                </div>

                <div style="margin: 30px 0; page-break-inside: avoid;">
                    <h2 style="color: #1e3c72; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">üìö Your Resources:</h2>
                    <div style="padding-left: 20px;">
                        <p style="margin: 10px 0;"><strong>üìò Complete Payment Plan Playbook (PDF):</strong></p>
                        <p style="margin: 5px 0 15px 20px; font-size: 0.9em;">https://drive.google.com/file/d/1tdJ9ahA53UEzE__3kYjGeIjC4SV6Cizg/view</p>
                        <p style="margin: 10px 0;"><strong>üìñ IRS Notice Decoder (PDF):</strong></p>
                        <p style="margin: 5px 0 15px 20px; font-size: 0.9em;">https://drive.google.com/file/d/1UfCAVZRmKe670CZ3BxnAphf2wjPs687N/view</p>
                        <p style="margin: 10px 0;"><strong>üìä Compliance Tracker (Spreadsheet):</strong></p>
                        <p style="margin: 5px 0 15px 20px; font-size: 0.9em;">https://docs.google.com/spreadsheets/d/1X_bpT6DNsrOjE602ScYUI_-2FGsD11mC/edit</p>
                    </div>
                </div>

                <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #e0e0e0; text-align: center; page-break-inside: avoid;">
                    <p style="font-size: 0.9em; color: #666;">Generated by IRS Notice Analyzer | Thomas Tax Strategists</p>
                    <p style="font-size: 0.9em; color: #666; margin-top: 5px;">This checklist is for reference only and is not legal or tax advice.</p>
                </div>
            </div>
            `;

            checklist.innerHTML = checklistHTML;
            document.body.appendChild(checklist);
        }

        function addPaymentPlanSection(container, answers) {
            // Check if balance is over $15K for strategic options messaging
            const showStrategicOptions = answers.amount === 'Over $25,000';
            
            const section = createExpandableSection(
                'üìò Set Up Your IRS Payment Plan',
                'Video tutorial to walk you through the process',
                `
                    <div style="padding: 20px;">
                        ${showStrategicOptions ? `
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                            <h4 style="color: white; margin-bottom: 15px; font-size: 1.3em;">üí° Your Balance May Qualify for Reduction</h4>
                            <p style="font-size: 1.05em; line-height: 1.6; margin-bottom: 15px;">With over $15,000 owed, you have options beyond a standard payment plan:</p>
                            <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 10px; margin: 15px 0;">
                                <p style="margin: 10px 0;"><strong>‚Ä¢ Offer in Compromise</strong> - Settle for less than you owe</p>
                                <p style="margin: 10px 0;"><strong>‚Ä¢ Partial Payment Plan</strong> - Pay only what IRS can collect</p>
                                <p style="margin: 10px 0;"><strong>‚Ä¢ Currently Not Collectible</strong> - Temporarily stop collection</p>
                                <p style="margin: 10px 0;"><strong>‚Ä¢ Penalty Abatement</strong> - Remove 25-47% of your balance</p>
                            </div>
                            <div style="text-align: center; margin-top: 20px;">
                                <button class="btn btn-primary" onclick="window.open('https://calendly.com/shontathomas/60-min-strategy-call', '_blank')" style="background: white; color: #1e3c72; padding: 15px 30px; font-size: 1.1em;">
                                    Schedule FREE Evaluation
                                </button>
                            </div>
                        </div>
                        ` : ''}

                        <h4 style="color: #1e3c72; margin-bottom: 15px;">üì∫ Video Tutorial: How to Set Up Your Payment Plan</h4>
                        <a href="https://www.loom.com/share/d8eadaa6a03c48a99c02b4a60df60b9e" target="_blank" style="display: block; text-decoration: none;">
                            <div style="width: 100%; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='scale(1.02)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.2)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                                <div style="font-size: 4em; margin-bottom: 15px;">‚ñ∂Ô∏è</div>
                                <div style="color: white; font-size: 1.3em; font-weight: 600; margin-bottom: 10px;">Watch: Step-by-Step IRS Payment Plan Setup</div>
                                <div style="color: rgba(255,255,255,0.8); font-size: 1em;">Click to watch on Loom (opens in new tab)</div>
                            </div>
                        </a>
                        <div style="text-align: center; margin: 15px 0; padding: 12px; background: #e8f4f8; border-radius: 8px;">
                            <p style="margin: 0; color: #1e3c72; font-size: 0.95em;">
                                üé¨ <strong>Video includes:</strong> Screen recording of the exact IRS.gov application process
                            </p>
                        </div>

                        <div style="text-align: center; margin-top: 30px;">
                            <a href="https://www.irs.gov/payments/online-payment-agreement-application" target="_blank" class="btn btn-primary" style="display: inline-block; text-decoration: none; padding: 18px 50px; font-size: 1.2em;">
                                Start My Application Now ‚Üí
                            </a>
                        </div>
                    </div>
                `,
                true
            );
            container.appendChild(section);
        }

        function addPenaltyAbatementLink(container) {
            const section = document.createElement('div');
            section.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
            section.style.color = 'white';
            section.style.padding = '30px';
            section.style.borderRadius = '15px';
            section.style.margin = '20px 0';
            section.style.cursor = 'pointer';
            section.onclick = () => window.open('penalty-abatement-guide.html', '_blank');
            section.innerHTML = `
                <h3 style="margin-bottom: 15px; font-size: 1.5em;">üí∞ Save 25-47% by Removing Penalties</h3>
                <p style="font-size: 1.1em; line-height: 1.6; margin-bottom: 20px;">Your notice shows penalties charges. Many taxpayers qualify to have these completely removed - keeping only the tax and interest.</p>
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <p style="margin: 5px 0;"><strong>‚úì</strong> First-Time Penalty Abatement (for clean history)</p>
                    <p style="margin: 5px 0;"><strong>‚úì</strong> Reasonable Cause Abatement (for documented hardship)</p>
                    <p style="margin: 5px 0;"><strong>‚úì</strong> Could save you thousands of dollars</p>
                </div>
                <div style="background: white; color: #1e3c72; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; font-size: 1.1em; margin-top: 20px;">
                    ‚Üí Click Here to Check If You Qualify (2 minutes)
                </div>
                <p style="font-size: 0.9em; margin-top: 15px; opacity: 0.9; text-align: center;">Free assessment ‚Ä¢ Instant results ‚Ä¢ Could save $1,000s</p>
            `;
            container.appendChild(section);
        }

        function addCP11DisputeSection(container, answers) {
            const section = createExpandableSection(
                'üìù How to Dispute CP11 Changes',
                'Written response with documentation showing why the IRS is wrong',
                `
                    <div style="padding: 20px;">
                        <div class="alert-box" style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px;">‚è∞ Response Deadline: 60 Days from Notice Date</h4>
                            <p>You have 60 days to respond. After that, the IRS assessment becomes final and harder to dispute.</p>
                        </div>

                        <h4 style="color: #1e3c72; margin-bottom: 15px;">Step 1: Understand What the IRS Changed</h4>
                        <p style="margin-bottom: 15px;">CP11 typically means one of these happened:</p>
                        <ul style="padding-left: 20px; margin-bottom: 20px; line-height: 1.8;">
                            <li>Mathematical error on your return</li>
                            <li>IRS adjusted a credit or deduction you claimed</li>
                            <li>IRS added income you didn't report (W-2, 1099, etc.)</li>
                            <li>IRS corrected your filing status</li>
                        </ul>

                        <h4 style="color: #1e3c72; margin-bottom: 15px;">Step 2: Gather Your Documentation</h4>
                        <div class="info-card" style="margin-bottom: 20px;">
                            <h4>üìã Documentation Checklist:</h4>
                            <ul style="padding-left: 20px; line-height: 1.8;">
                                <li>Your original tax return (the one you filed)</li>
                                <li>W-2s, 1099s, and other income documents</li>
                                <li>Receipts or records supporting deductions</li>
                                <li>Documentation proving credits claimed</li>
                                <li>Bank statements if income is in question</li>
                                <li>Any other proof that supports your original return</li>
                            </ul>
                            <p style="margin-top: 15px; font-weight: bold;">‚ö†Ô∏è NEVER send originals - only copies!</p>
                        </div>

                        <h4 style="color: #1e3c72; margin-bottom: 15px;">Step 3: Write Your Response Letter</h4>
                        <div class="template-box" style="margin: 20px 0;">
                            <p><strong>Sample CP11 Dispute Letter:</strong></p>
                            <p style="margin-top: 20px;">[Your Name]<br>
                            [Your Address]<br>
                            [City, State ZIP]<br>
                            [Your Phone]<br>
                            [Your Email]</p>

                            <p style="margin-top: 20px;">[Date]</p>

                            <p style="margin-top: 20px;">Internal Revenue Service<br>
                            [Address from CP11 notice]</p>

                            <p style="margin-top: 20px;"><strong>RE: Response to Notice CP11</strong><br>
                            Taxpayer: [Your Name]<br>
                            SSN: [XXX-XX-####]<br>
                            Tax Year: [YYYY]<br>
                            Notice Date: [Date on Notice]</p>

                            <p style="margin-top: 20px;">Dear Sir or Madam:</p>

                            <p style="margin-top: 15px;">I am writing in response to Notice CP11 dated [notice date], which proposes changes to my [tax year] tax return resulting in additional tax of $[amount].</p>

                            <p style="margin-top: 15px;"><strong>I disagree with the following change(s):</strong></p>

                            <p style="margin-top: 15px;"><span style="background: #fff3cd; padding: 2px 8px; border-radius: 4px;">[Specifically identify what you disagree with - be very specific about line numbers and amounts]</span></p>

                            <p style="margin-top: 15px;"><strong>Explanation and Supporting Documentation:</strong></p>

                            <p style="margin-top: 15px;"><span style="background: #fff3cd; padding: 2px 8px; border-radius: 4px;">[Explain why your original return was correct. Reference specific documents you're including. Be factual and detailed.]</span></p>

                            <p style="margin-top: 15px;">Example: "The notice states I failed to report income of $5,000 from ABC Company. However, I did report this income on line 1 of my Form 1040 as shown on the enclosed copy of my return. The $5,000 is included in my total wages of $45,000. I have attached a copy of the W-2 from ABC Company showing this income, along with a copy of my original return highlighting where this amount was reported."</p>

                            <p style="margin-top: 15px;"><strong>Enclosed Documentation:</strong></p>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><span style="background: #fff3cd; padding: 2px 8px; border-radius: 4px;">[List each document: "Copy of 2023 Form 1040 with line 1 highlighted"]</span></li>
                                <li><span style="background: #fff3cd; padding: 2px 8px; border-radius: 4px;">[Continue listing...]</span></li>
                            </ul>

                            <p style="margin-top: 15px;">Based on the enclosed documentation, I respectfully request that you reverse the proposed changes and adjust my account to reflect the amounts I originally reported on my return.</p>

                            <p style="margin-top: 15px;">Please contact me at [phone] if you need any additional information.</p>

                            <p style="margin-top: 20px;">Sincerely,</p>

                            <p style="margin-top: 40px;"><span style="background: #fff3cd; padding: 2px 8px; border-radius: 4px;">[Your signature]</span><br>
                            <span style="background: #fff3cd; padding: 2px 8px; border-radius: 4px;">[Your printed name]</span></p>

                            <p style="margin-top: 20px;"><strong>Enclosures:</strong> [List documents]</p>
                        </div>

                        <h4 style="color: #1e3c72; margin-bottom: 15px;">Step 4: Mail Your Response</h4>
                        <div class="warning-box" style="margin: 20px 0;">
                            <h4>üìÆ Mailing Instructions:</h4>
                            <ul style="padding-left: 20px; line-height: 1.8; margin-top: 10px;">
                                <li>Mail to the address shown on your CP11 notice</li>
                                <li>Use <strong>Certified Mail with Return Receipt</strong> ($8 at post office)</li>
                                <li>Mail at least 7-10 days before the 60-day deadline</li>
                                <li>Keep copies of everything you mail</li>
                                <li>Save your certified mail receipt and tracking number</li>
                            </ul>
                        </div>

                        <h4 style="color: #1e3c72; margin-bottom: 15px;">Step 5: Follow Up</h4>
                        <div style="background: #e8f4f8; padding: 20px; border-radius: 10px;">
                            <p style="margin-bottom: 10px;"><strong>Timeline:</strong></p>
                            <ul style="padding-left: 20px; line-height: 1.8;">
                                <li><strong>2-4 weeks:</strong> IRS receives and processes your response</li>
                                <li><strong>6-12 weeks:</strong> IRS mails decision letter</li>
                                <li><strong>If approved:</strong> They'll adjust your account and send updated balance</li>
                                <li><strong>If denied:</strong> You'll receive explanation and appeal rights</li>
                            </ul>
                        </div>

                        ${answers.amount === 'Over $15,000' || answers.agreeWithChanges === 'Not sure' ? `
                        <div class="alert-box" style="margin-top: 30px; background: #fff3cd; border-left: 4px solid #ff9800;">
                            <h4 style="color: #856404; margin-bottom: 10px;">üí° Consider Professional Help</h4>
                            <p style="margin-bottom: 15px;">Disputing IRS changes is technically complex. Professional representation can:</p>
                            <ul style="padding-left: 20px; line-height: 1.8;">
                                <li>Review your return and the IRS changes for accuracy</li>
                                <li>Identify additional supporting documentation</li>
                                <li>Write a technically sound response with proper legal citations</li>
                                <li>Handle IRS correspondence and negotiations</li>
                                <li>Represent you in appeals if needed</li>
                            </ul>
                            <button class="btn btn-danger" onclick="window.open('https://calendly.com/shontathomas/60-min-strategy-call', '_blank')" style="margin-top: 15px;">
                                Schedule Strategy Call for CP11 Review
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `,
                true
            );
            container.appendChild(section);
        }

        function addCP2000ResponseSection(container, answers) {
            const section = createExpandableSection(
                'üìã How to Respond to CP2000',
                'Letter template, documentation checklist, and mailing instructions',
                `
                    <div style="padding: 20px;">
                        <div class="alert-box">
                            <h4>‚è∞ Deadline: 30 Days from Notice Date</h4>
                            <p>You can request an additional 30 days if needed, but request BEFORE the original deadline passes.</p>
                        </div>

                        <h4 style="color: #1e3c72; margin: 20px 0 15px 0;">Step 1: Compare Notice to Your Return</h4>
                        <p>The CP2000 shows line-by-line what the IRS thinks is incorrect. Pull out your tax return and compare carefully.</p>

                        <h4 style="color: #1e3c72; margin: 20px 0 15px 0;">Step 2: Your Response Strategy</h4>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #667eea;">
                            <p><strong>You Selected: ${answers.agreeWithChanges || 'Not specified'}</strong></p>
                            ${answers.agreeWithChanges === 'I agree completely' ? 
                                '<p style="margin-top: 10px;">‚Üí Sign and return the response form included with your notice<br>‚Üí Pay the amount OR set up a payment plan using the tool above</p>' :
                                answers.agreeWithChanges === 'I disagree completely' ?
                                '<p style="margin-top: 10px;">‚Üí Use the letter template below<br>‚Üí Gather your supporting documentation<br>‚Üí Mail via certified mail with return receipt</p>' :
                                answers.agreeWithChanges === 'I partially agree' ?
                                '<p style="margin-top: 10px;">‚Üí Mark which items you agree/disagree with on the response form<br>‚Üí Provide documentation ONLY for disputed items<br>‚Üí Use parts of the letter template below</p>' :
                                '<p style="margin-top: 10px;">‚Üí Review the letter template below<br>‚Üí Consider scheduling a strategy call if unsure</p>'
                            }
                        </div>

                        ${answers.agreeWithChanges !== 'I agree completely' ? `
                        <h4 style="color: #1e3c72; margin: 30px 0 15px 0;">CP2000 Response Letter Template:</h4>
                        <div class="template-box">
[Your Name]<br>
[Your Address]<br>
[City, State ZIP]<br>
[Phone Number]<br><br>

[Today's Date]<br><br>

Internal Revenue Service<br>
[Address from your CP2000 notice - use the exact address shown]<br><br>

<strong>RE: Response to CP2000 Notice</strong><br>
Notice Date: [Date on your notice]<br>
Tax Year: [Year from notice]<br>
SSN: [Your SSN - XXX-XX-####]<br><br>

Dear Sir or Madam:<br><br>

I am writing in response to CP2000 Notice dated [date] proposing changes to my [year] tax return. I ${answers.agreeWithChanges === 'I disagree completely' ? 'disagree' : answers.agreeWithChanges === 'I partially agree' ? 'partially agree' : 'disagree'} with the proposed changes for the following reasons:<br><br>

<span style="background: #fff3cd; padding: 4px 8px; border-radius: 4px; font-weight: bold;">[Explain specifically why the IRS is wrong. Reference line numbers from the CP2000. Example: "Line 3 shows unreported 1099-MISC income of $5,000. This is incorrect because I did report this income on Schedule C, Line 1 of my original return."]</span><br><br>

The documentation enclosed supports my position:<br><br>

<ul style="margin: 10px 0 10px 30px; line-height: 1.8;">
<li><span style="background: #fff3cd; padding: 4px 8px; border-radius: 4px; font-weight: bold;">[Document 1: e.g., "Copy of Schedule C showing $5,000 reported"]</span></li>
<li><span style="background: #fff3cd; padding: 4px 8px; border-radius: 4px; font-weight: bold;">[Document 2: e.g., "Copy of 1099-MISC from XYZ Company"]</span></li>
<li><span style="background: #fff3cd; padding: 4px 8px; border-radius: 4px; font-weight: bold;">[Document 3: e.g., "Bank statements showing income deposit"]</span></li>
</ul><br>

Pursuant to IRC ¬ß 6201 and Treasury Regulation ¬ß 1.6001-1, I request that the IRS reconsider the proposed assessment based on this documentation. The burden of proof provisions under IRC ¬ß 7491 support my position as I have substantiated the items in question.<br><br>

Please contact me at [your phone number] if you need additional information or clarification.<br><br>

Sincerely,<br><br><br>

[Your signature]<br>
[Your printed name]<br><br>

<strong>Enclosures:</strong><br>
- CP2000 Response Form (signed)<br>
- [List each document you're including]
                        </div>

                        <div style="background: #e8f4f8; padding: 20px; border-radius: 10px; margin-top: 20px;">
                            <h4 style="color: #1e3c72; margin-bottom: 15px;">üìé Documentation Checklist:</h4>
                            <ul style="padding-left: 20px; line-height: 1.8;">
                                <li><strong>COPIES ONLY</strong> - never send originals</li>
                                <li>Completed CP2000 response form (came with your notice)</li>
                                <li>Your signed letter (using template above)</li>
                                <li>Copy of your original tax return</li>
                                <li>All supporting documents (W-2s, 1099s, receipts, statements, etc.)</li>
                                <li>Any corrected forms if you have them</li>
                            </ul>
                        </div>

                        <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-top: 20px;">
                            <h4 style="color: #856404; margin-bottom: 15px;">üì¨ How to Mail Your Response:</h4>
                            <p style="margin-bottom: 10px;"><strong>Where:</strong> Use the address printed on your CP2000 notice</p>
                            <p style="margin-bottom: 10px;"><strong>How:</strong> Certified Mail with Return Receipt Requested (~$8 at post office)</p>
                            <p style="margin-bottom: 10px;"><strong>When:</strong> Mail at least 7-10 days before your deadline</p>
                            <p style="margin-bottom: 10px;"><strong>Keep:</strong> Copies of everything + your certified mail receipt</p>
                        </div>
                        ` : ''}

                        ${answers.proposedAmount === 'Over $10,000' || answers.agreeWithChanges === 'I\'m not sure' ? `
                        <div class="alert-box" style="margin-top: 30px;">
                            <h4 style="margin-bottom: 15px;">‚ö†Ô∏è Consider Professional Help for Your Situation</h4>
                            <p style="margin-bottom: 15px;">CP2000 responses over $10,000 or complex disputes benefit significantly from professional representation. We can:</p>
                            <ul style="padding-left: 20px; margin-bottom: 20px;">
                                <li>Review your documentation for completeness</li>
                                <li>Strengthen your response with additional legal citations</li>
                                <li>Negotiate directly with the IRS examiner</li>
                                <li>Handle appeals if your initial response is denied</li>
                            </ul>
                            <button class="btn btn-primary" onclick="window.open('https://calendly.com/shontathomas/60-min-strategy-call', '_blank')" style="width: 100%;">
                                Schedule Strategy Call - Review My CP2000
                            </button>
                            <p style="margin-top: 15px; font-size: 0.9em; text-align: center;">Professional representation often saves more than it costs in these situations</p>
                        </div>
                        ` : ''}
                    </div>
                `,
                true
            );
            container.appendChild(section);
        }

        function addReinstatementSection(container, answers) {
            const section = createExpandableSection(
                'üîß Reinstate Your Payment Plan',
                'Step-by-step instructions + letter template to cure your default in 30 days',
                `
                    <div style="padding: 20px;">
                        <div class="alert-box">
                            <h4 style="margin-bottom: 10px;">‚è∞ Critical Deadline: 30 Days from CP523 Notice Date</h4>
                            <p>After 30 days, your agreement terminates and the IRS can immediately begin levy actions (seizing bank accounts, garnishing wages).</p>
                        </div>

                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #667eea;">
                            <h4 style="color: #1e3c72; margin-bottom: 10px;">What Caused Your Default:</h4>
                            <p style="font-size: 1.1em;"><strong>${answers.defaultReason || 'Not specified'}</strong></p>
                        </div>

                        <h4 style="color: #1e3c72; margin: 20px 0 15px 0;">How to Reinstate (Do These Steps in Order):</h4>
                        
                        <div class="timeline">
                            <div class="timeline-item">
                                <h4>Step 1: Make All Missed Payments IMMEDIATELY</h4>
                                ${answers.canCatchUp === 'yes' ? 
                                    '<div style="background: #d4edda; padding: 15px; border-radius: 8px; margin: 10px 0;"><p><strong>‚úì You indicated you can catch up</strong> - Do this RIGHT NOW before anything else:</p></div>' :
                                    '<div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 10px 0;"><p><strong>‚ö†Ô∏è You indicated you cannot catch up on payments.</strong> Professional help is strongly recommended to negotiate modified terms. The IRS rarely reinstates without full payment of arrears.</p></div>'
                                }
                                <p style="margin-top: 15px;"><strong>What to pay:</strong></p>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>All missed payments</li>
                                    <li>PLUS your next scheduled payment</li>
                                    <li>Total it up and pay the full amount today</li>
                                </ul>
                                <p style="margin-top: 15px;"><strong>How to pay:</strong></p>
                                <p style="margin: 10px 0;">Use IRS Direct Pay: <a href="https://www.irs.gov/directpay" target="_blank" style="color: #667eea; font-weight: bold;">www.irs.gov/directpay</a></p>
                                <p style="margin: 10px 0;">Get and save the confirmation number for EACH payment you make.</p>
                            </div>
                            
                            <div class="timeline-item">
                                <h4>Step 2: Call the IRS Within 24-48 Hours of Payment</h4>
                                <p style="margin-bottom: 15px;"><strong>Call the number shown on your CP523 notice</strong> (NOT the general IRS number)</p>
                                <div style="background: #e8f4f8; padding: 15px; border-radius: 8px;">
                                    <p style="margin-bottom: 10px;"><strong>What to say:</strong></p>
                                    <p style="font-style: italic; margin: 10px 0 10px 20px;">"I received CP523 notice dated [date] and have made all missed payments today. My confirmation numbers are [list them]. I'm requesting immediate reinstatement of my installment agreement."</p>
                                    <p style="margin-top: 15px;"><strong>Write down:</strong></p>
                                    <ul style="margin: 10px 0; padding-left: 20px;">
                                        <li>Representative name: _______________</li>
                                        <li>Representative ID number: _______________</li>
                                        <li>Date and time of call: _______________</li>
                                        <li>Did they confirm reinstatement? YES / NO</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <h4>Step 3: Send Written Reinstatement Request</h4>
                                <p>Follow up your phone call with a written request using the template below.</p>
                            </div>
                        </div>

                        <h4 style="color: #1e3c72; margin: 30px 0 15px 0;">Reinstatement Request Letter Template:</h4>
                        <div class="template-box">
[Your Name]<br>
[Your Address]<br>
[City, State ZIP]<br>
[Phone Number]<br><br>

[Today's Date]<br><br>

Internal Revenue Service<br>
[Address from your CP523 notice]<br><br>

<strong>RE: Request for Reinstatement of Installment Agreement</strong><br>
Notice: CP523 dated [date from your notice]<br>
Tax Year(s): [Years listed on notice]<br>
SSN: [XXX-XX-####]<br>
Original Agreement Number: <span style="background: #fff3cd; padding: 4px 8px; border-radius: 4px; font-weight: bold;">[Look on your original IA approval letter]</span><br><br>

Dear Sir or Madam:<br><br>

I am writing to request immediate reinstatement of my installment agreement that defaulted due to ${answers.defaultReason === 'Missed payment(s)' ? 'missed payment(s)' : answers.defaultReason === 'Filed return late' ? 'late filed return' : answers.defaultReason === 'Owed new taxes' ? 'owing new taxes' : answers.defaultReason || '[specify reason]'}.<br><br>

<strong>CORRECTIVE ACTIONS TAKEN:</strong><br><br>

I have taken the following immediate corrective actions:<br><br>

<ul style="margin: 10px 0 10px 30px; line-height: 1.8;">
${answers.defaultReason === 'Missed payment(s)' || !answers.defaultReason ? 
`<li>Made all missed payments on [date] totaling $<span style="background: #fff3cd; padding: 4px 8px; border-radius: 4px; font-weight: bold;">[amount]</span></li>
<li>Confirmation numbers: <span style="background: #fff3cd; padding: 4px 8px; border-radius: 4px; font-weight: bold;">[list all confirmation numbers]</span></li>
<li>Set up multiple payment reminders and bank alerts to prevent future missed payments</li>` : ''}
${answers.defaultReason === 'Filed return late' ?
`<li>Filed the late return for tax year [year] on [date]</li>
<li>Set up calendar reminders for all future filing deadlines</li>` : ''}
${answers.defaultReason === 'Owed new taxes' ?
`<li>Adjusted my W-4 withholding to prevent future tax debt</li>
<li>Began making quarterly estimated tax payments</li>
<li>Set up compliance safeguards</li>` : ''}
</ul><br>

${answers.defaultReason === 'Missed payment(s)' || !answers.defaultReason ?
`<strong>EXPLANATION OF CIRCUMSTANCES:</strong><br><br>

The missed payment(s) were due to <span style="background: #fff3cd; padding: 4px 8px; border-radius: 4px; font-weight: bold;">[Explain your circumstances: "temporary job loss from March-May 2024", "unexpected medical emergency requiring hospitalization", "family emergency", etc. Be specific but brief.]</span><br><br>

This was a temporary situation that has been fully resolved. I now have <span style="background: #fff3cd; padding: 4px 8px; border-radius: 4px; font-weight: bold;">[explain what changed: "returned to full-time employment", "recovered and returned to work", "stabilized finances", etc.]</span><br><br>` : ''}

<strong>COMMITMENT TO COMPLIANCE:</strong><br><br>

I am fully committed to maintaining compliance with all terms of the installment agreement going forward. To ensure this, I have implemented the following safeguards:<br><br>

<ul style="margin: 10px 0 10px 30px; line-height: 1.8;">
<li>Set up recurring payment reminders 3 days before each due date</li>
<li>Established low-balance alerts on my bank account</li>
<li>Created dedicated savings buffer for IRS payments</li>
<li>Adjusted withholding/estimated payments to prevent future tax debt</li>
</ul><br>

Pursuant to IRM 5.14.2.4 (Installment Agreement Default Procedures) and IRM 5.14.2.5 (Reinstatement of Defaulted Installment Agreements), I respectfully request immediate reinstatement of my installment agreement.<br><br>

I spoke with IRS Representative <span style="background: #fff3cd; padding: 4px 8px; border-radius: 4px; font-weight: bold;">[name]</span>, ID# <span style="background: #fff3cd; padding: 4px 8px; border-radius: 4px; font-weight: bold;">[number]</span> on <span style="background: #fff3cd; padding: 4px 8px; border-radius: 4px; font-weight: bold;">[date]</span> who indicated reinstatement would be processed.<br><br>

Please contact me at [your phone number] to confirm reinstatement or if you need any additional information.<br><br>

Sincerely,<br><br><br>

[Your signature]<br>
[Your printed name]<br><br>

<strong>Enclosures:</strong><br>
- Proof of missed payments (IRS Direct Pay confirmation receipts)
                        </div>

                        <div style="background: #e8f4f8; padding: 20px; border-radius: 10px; margin-top: 20px;">
                            <h4 style="color: #1e3c72; margin-bottom: 15px;">üì¨ Mailing Instructions:</h4>
                            <p style="margin: 10px 0;"><strong>Where:</strong> Use the address printed on your CP523 notice</p>
                            <p style="margin: 10px 0;"><strong>How:</strong> Certified Mail with Return Receipt Requested</p>
                            <p style="margin: 10px 0;"><strong>When:</strong> Mail within 2-3 days of making your payments and calling</p>
                            <p style="margin: 10px 0;"><strong>Cost:</strong> ~$8 at the post office (worth every penny for proof of mailing)</p>
                            <p style="margin: 10px 0;"><strong>Keep:</strong> Copies of everything + your certified mail receipt</p>
                        </div>

                        <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-top: 20px;">
                            <h4 style="color: #856404; margin-bottom: 15px;">‚è±Ô∏è Timeline After You Mail:</h4>
                            <ul style="padding-left: 20px; line-height: 1.8;">
                                <li><strong>Week 1:</strong> IRS receives your letter (confirmed by return receipt)</li>
                                <li><strong>Weeks 2-4:</strong> IRS reviews and processes reinstatement</li>
                                <li><strong>Weeks 4-6:</strong> You receive written confirmation of reinstatement</li>
                                <li><strong>Important:</strong> Continue making scheduled payments while waiting for confirmation</li>
                            </ul>
                        </div>

                        ${answers.canCatchUp === 'no' || answers.previousDefaults === 'yes' ? `
                        <div class="alert-box" style="margin-top: 30px;">
                            <h4 style="margin-bottom: 15px;">‚ö†Ô∏è Your Situation Requires Professional Help</h4>
                            <p style="margin-bottom: 15px;">${answers.canCatchUp === 'no' ? 
                                'Since you cannot catch up on missed payments, you need to negotiate modified terms with the IRS. This requires demonstrating financial hardship and proposing a sustainable alternative plan. The IRS rarely grants this without professional representation.' :
                                'Multiple payment plan defaults make reinstatement extremely difficult. The IRS views repeat defaulters as non-compliant and will scrutinize any reinstatement request heavily. Professional representation showing changed circumstances and guaranteed compliance significantly improves your chances.'
                            }</p>
                            <p style="margin-bottom: 20px;"><strong>What we can do:</strong></p>
                            <ul style="padding-left: 20px; margin-bottom: 20px;">
                                <li>Negotiate modified payment terms you can actually afford</li>
                                <li>Document your financial hardship properly</li>
                                <li>Present your case in the best possible light</li>
                                <li>Provide guarantees of future compliance</li>
                                <li>File appeals if reinstatement is denied</li>
                            </ul>
                            <button class="btn btn-primary" onclick="window.open('https://calendly.com/shontathomas/60-min-strategy-call', '_blank')" style="width: 100%;">
                                Schedule Emergency Strategy Call
                            </button>
                            <p style="margin-top: 15px; font-size: 0.9em; text-align: center;">Act fast - you only have 30 days from your CP523 date</p>
                        </div>
                        ` : ''}
                    </div>
                `,
                true
            );
            container.appendChild(section);
        }

        function addEmergencyHelpSection(container) {
            const section = document.createElement('div');
            section.className = 'alert-box';
            section.style.background = '#721c24';
            section.style.color = 'white';
            section.style.border = 'none';
            section.innerHTML = `
                <h3 style="color: white; margin-bottom: 20px; font-size: 1.6em;">üö® CRITICAL: Immediate Professional Help Required</h3>
                <p style="font-size: 1.1em; margin-bottom: 20px; line-height: 1.6;">CP90/CP297 or Letter 1058 (Intent to Levy) notices mean the IRS can seize your assets AT ANY TIME after the 30-day deadline. Bank accounts can be drained. Wages can be garnished up to 70%. This is NOT a DIY situation.</p>
                
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4 style="color: white; margin-bottom: 15px; font-size: 1.2em;">What We Can Do in the Next 24-48 Hours:</h4>
                    <ul style="padding-left: 20px; line-height: 1.8; font-size: 1.05em;">
                        <li><strong>File Collection Due Process (CDP) hearing</strong> (Form 12153) - legally stops the levy</li>
                        <li><strong>Negotiate Currently Not Collectible (CNC) status</strong> if you qualify based on hardship</li>
                        <li><strong>Set up protective payment plan</strong> to prevent immediate enforcement</li>
                        <li><strong>Request Offer in Compromise evaluation</strong> to potentially settle for less</li>
                        <li><strong>Challenge IRS procedures or calculations</strong> if there are errors</li>
                        <li><strong>Request lien withdrawal</strong> if already filed</li>
                    </ul>
                </div>

                <div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4 style="color: #721c24; margin-bottom: 15px;">‚è∞ The 30-Day Window Is Absolute</h4>
                    <p style="color: #333; line-height: 1.6;">You have 30 days from the notice date to request a Collection Due Process hearing. This is your legal right to a hearing before the IRS can seize your assets. After 30 days, this right expires and your options become severely limited.</p>
                </div>

                <button class="btn btn-primary" onclick="window.open('https://calendly.com/shontathomas/60-min-strategy-call', '_blank')" style="width: 100%; background: white; color: #721c24; font-size: 1.2em; padding: 20px;">
                    Schedule Emergency Call NOW - Don't Wait
                </button>
                
                <p style="margin-top: 20px; font-size: 0.95em; text-align: center; opacity: 0.9;">Every day counts. The sooner we act, the more options you have.</p>
            `;
            container.appendChild(section);
        }

        function addNoticeDecoderSection(container) {
            const section = createExpandableSection(
                'üìñ IRS Notice Decoder - Complete Reference Guide',
                'Lookup any IRS notice ‚Ä¢ Understand what it means ‚Ä¢ Know your deadlines',
                `
                    <div style="padding: 20px;">
                        <p style="font-size: 1.1em; line-height: 1.6; margin-bottom: 20px;">Our comprehensive IRS Notice Decoder covers over 50 different IRS notices with detailed explanations, deadlines, and response instructions for each one.</p>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <h4 style="color: #1e3c72; margin-bottom: 15px;">üìã What's Included:</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #667eea;">
                                    <h5 style="color: #1e3c72; margin-bottom: 8px;">Informational Notices</h5>
                                    <p style="font-size: 0.95em; color: #666;">CP05, CP12, CP21, CP22 - Notices that don't require action</p>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #ff9800;">
                                    <h5 style="color: #1e3c72; margin-bottom: 8px;">Action Required</h5>
                                    <p style="font-size: 0.95em; color: #666;">CP14, CP501, CP2000, CP525 - 30-60 day response window</p>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #dc3545;">
                                    <h5 style="color: #1e3c72; margin-bottom: 8px;">Critical Notices</h5>
                                    <p style="font-size: 0.95em; color: #666;">CP90, LT11, Letter 1058 - Immediate action required</p>
                                </div>
                            </div>
                        </div>

                        <div style="background: #e8f4f8; padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <h4 style="color: #1e3c72; margin-bottom: 15px;">For Each Notice, You Get:</h4>
                            <ul style="padding-left: 20px; line-height: 1.8;">
                                <li><strong>Plain English explanation</strong> of what the notice means</li>
                                <li><strong>Why you received it</strong> and what triggered it</li>
                                <li><strong>Specific deadline</strong> (if any) and consequences of missing it</li>
                                <li><strong>Step-by-step response instructions</strong></li>
                                <li><strong>Letter templates</strong> where applicable</li>
                                <li><strong>Red flags</strong> that mean you need professional help</li>
                            </ul>
                        </div>

                        <div style="text-align: center; margin-top: 30px;">
                            <p style="font-size: 1.1em; margin-bottom: 15px; color: #1e3c72; font-weight: 600;">Download the complete 47-page PDF reference guide:</p>
                            <button class="btn btn-primary" onclick="window.open('https://drive.google.com/file/d/1UfCAVZRmKe670CZ3BxnAphf2wjPs687N/view?usp=sharing', '_blank')" style="padding: 15px 40px; font-size: 1.1em;">
                                üì• Download Complete Notice Decoder (PDF)
                            </button>
                            <p style="margin-top: 15px; font-size: 0.9em; color: #666;">Keep it with your tax records for quick reference anytime</p>
                        </div>
                    </div>
                `
            );
            container.appendChild(section);
        }

        function calculatePayment() {
            const balance = parseFloat(document.getElementById('calcBalance').value);
            const months = parseInt(document.getElementById('calcMonths').value);
            
            if (!balance || balance <= 0) {
                alert('Please enter your balance amount');
                return;
            }
            
            const monthlyPayment = balance / months;
            const interestRate = 0.08;
            const avgBalance = balance / 2;
            const totalInterest = avgBalance * (interestRate / 12) * months;
            const failureToPayPenalty = balance * 0.0025 * months;
            const totalPaid = balance + totalInterest + failureToPayPenalty;
            const setupFee = months <= 6 ? 0 : 31;
            
            document.getElementById('paymentResult').innerHTML = `
                <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 20px; border-radius: 10px; border: 2px solid #667eea;">
                    <div style="display: grid; gap: 10px;">
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                            <span><strong>Monthly Payment:</strong></span>
                            <span style="font-size: 1.2em; color: #1e3c72; font-weight: bold;">$${monthlyPayment.toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                            <span>Number of Payments:</span>
                            <span>${months} months</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                            <span>Estimated Interest (~8%/year):</span>
                            <span>$${totalInterest.toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                            <span>Failure-to-Pay Penalty (0.25%/mo):</span>
                            <span>$${failureToPayPenalty.toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                            <span>Setup Fee:</span>
                            <span>$${setupFee}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 15px 0 5px 0; border-top: 2px solid #667eea;">
                            <span style="font-size: 1.1em;"><strong>Total You'll Pay:</strong></span>
                            <span style="font-size: 1.3em; color: #1e3c72; font-weight: bold;">$${(totalPaid + setupFee).toFixed(2)}</span>
                        </div>
                    </div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <p style="margin: 0; font-size: 0.95em; color: #856404;">üí° <strong>Pro Tip:</strong> You can pay extra anytime with no prepayment penalty! Even one extra payment per year can save you hundreds in interest and pay off months earlier.</p>
                    </div>
                </div>
            `;
        }

        function createExpandableSection(title, description, content, startExpanded = false) {
            const section = document.createElement('div');
            section.style.margin = '20px 0';
            section.style.border = '2px solid #667eea';
            section.style.borderRadius = '15px';
            section.style.overflow = 'hidden';
            
            const header = document.createElement('div');
            header.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            header.style.color = 'white';
            header.style.padding = '20px 25px';
            header.style.cursor = 'pointer';
            header.style.display = 'flex';
            header.style.justifyContent = 'space-between';
            header.style.alignItems = 'center';
            header.style.transition = 'all 0.3s ease';
            
            header.innerHTML = `
                <div style="flex: 1;">
                    <h3 style="margin-bottom: 5px; font-size: 1.3em;">${title}</h3>
                    <p style="opacity: 0.9; font-size: 0.95em; margin: 0;">${description}</p>
                </div>
                <span style="font-size: 1.5em; transition: transform 0.3s; margin-left: 20px;">${startExpanded ? '‚ñ≤' : '‚ñº'}</span>
            `;
            
            const contentDiv = document.createElement('div');
            contentDiv.style.display = startExpanded ? 'block' : 'none';
            contentDiv.style.background = 'white';
            contentDiv.innerHTML = content;
            
            // Set initial arrow rotation if expanded
            if (startExpanded) {
                setTimeout(() => {
                    header.querySelector('span').style.transform = 'rotate(180deg)';
                }, 0);
            }
            
            header.onclick = () => {
                const isOpen = contentDiv.style.display === 'block';
                contentDiv.style.display = isOpen ? 'none' : 'block';
                header.querySelector('span').style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
                
                if (!isOpen) {
                    setTimeout(() => {
                        header.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);
                }
            };
            
            header.onmouseover = () => {
                header.style.background = 'linear-gradient(135deg, #5568d3 0%, #6a3f8f 100%)';
            };
            
            header.onmouseout = () => {
                header.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            };
            
            section.appendChild(header);
            section.appendChild(contentDiv);
            
            return section;
        }

        function getProfessionalHelpReason() {
            const noticeType = noticeData.type;
            const answers = followUpAnswers;

            if (noticeType === 'CP90') {
                return 'Levy notices require immediate professional intervention. The IRS can seize your assets at any time after this notice. We can file Collection Due Process hearings, negotiate Currently Not Collectible status, or set up protective payment plans.';
            }

            if (noticeType === 'CP2000' && answers.proposedAmount === 'Over $10,000') {
                return 'CP2000 disputes over $10,000 require careful documentation and IRS negotiation. Professional representation typically saves significantly more than the fee costs, and prevents costly mistakes in your response.';
            }

            if (answers.amount === 'Over $25,000') {
                return 'Balances over $25,000 often qualify for alternative resolution options beyond standard payment plans - including Offer in Compromise (settling for less), Partial Payment Plans, or Currently Not Collectible status. A strategic analysis can save you thousands.';
            }

            if (noticeType === 'CP523' && answers.previousDefaults === 'yes') {
                return 'Multiple payment plan defaults make reinstatement difficult. The IRS is less likely to grant you another chance without professional representation showing changed circumstances and guaranteed compliance.';
            }

            return 'Based on your situation, professional help will likely save you more money than it costs. Complex cases benefit from expert negotiation, strategic positioning, and knowledge of IRS policies.';
        }

        function downloadActionPlan() {
            var balanceDisplay = followUpAnswers.exactBalance ? 
                '$' + followUpAnswers.exactBalance.toLocaleString() : 
                (followUpAnswers.amount || '_______');
            
            var noticeType = noticeData && noticeData.type ? noticeData.type : 'IRS Notice';
            var deadline = noticeData && noticeData.hasDeadline ? noticeData.deadline : 'As soon as possible';
            
            var html = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>My IRS Action Plan - ' + noticeType + '</title>';
            html += '<style>body{font-family:Arial,sans-serif;padding:40px;max-width:800px;margin:0 auto;line-height:1.6}';
            html += 'h1{color:#1e3c72;text-align:center;border-bottom:3px solid #1e3c72;padding-bottom:15px}';
            html += 'h2{color:#1e3c72;margin-top:30px;border-bottom:2px solid #667eea;padding-bottom:8px}';
            html += '.deadline{background:#fff3cd;padding:15px 20px;border-left:4px solid #dc3545;margin:25px 0}';
            html += '.checklist-item{padding:12px 0;border-bottom:1px solid #eee;display:flex;align-items:flex-start;gap:12px}';
            html += '.checkbox{width:20px;height:20px;border:2px solid #667eea;border-radius:4px;flex-shrink:0;margin-top:2px}';
            html += '.links{background:#f8f9fa;padding:20px;border-radius:8px;margin:20px 0}';
            html += '.links p{margin:8px 0}';
            html += '.footer{text-align:center;margin-top:40px;padding-top:20px;border-top:2px solid #e0e0e0;color:#666;font-size:0.9em}';
            html += '@media print{body{padding:20px}}</style></head><body>';
            
            html += '<h1>My IRS Resolution Action Plan</h1>';
            html += '<p style="text-align:center;color:#666">Notice: ' + noticeType + ' | Created: ' + new Date().toLocaleDateString() + '</p>';
            
            html += '<div class="deadline"><strong>‚ö†Ô∏è DEADLINE:</strong> ' + deadline + '</div>';
            
            html += '<h2>üìã Action Checklist</h2>';
            html += '<div class="checklist-item"><div class="checkbox"></div><div>Get IRS account transcript from <strong>www.irs.gov/account</strong></div></div>';
            html += '<div class="checklist-item"><div class="checkbox"></div><div>Verify balance: <strong>' + balanceDisplay + '</strong></div></div>';
            html += '<div class="checklist-item"><div class="checkbox"></div><div>Gather bank account info (routing number & account number)</div></div>';
            html += '<div class="checklist-item"><div class="checkbox"></div><div>Have prior year tax return ready for security questions</div></div>';
            html += '<div class="checklist-item"><div class="checkbox"></div><div>Go to <strong>www.irs.gov/payments</strong> ‚Üí Click "Apply for Payment Plan"</div></div>';
            html += '<div class="checklist-item"><div class="checkbox"></div><div>Use direct debit for lowest fee ($31)</div></div>';
            html += '<div class="checklist-item"><div class="checkbox"></div><div>Choose payment date 2-3 days after payday</div></div>';
            html += '<div class="checklist-item"><div class="checkbox"></div><div>Triple-check bank routing & account numbers before submitting</div></div>';
            html += '<div class="checklist-item"><div class="checkbox"></div><div>Save confirmation number: _________________</div></div>';
            html += '<div class="checklist-item"><div class="checkbox"></div><div>Set up calendar reminders 3 days before each payment</div></div>';
            html += '<div class="checklist-item"><div class="checkbox"></div><div>Set up low-balance alerts on bank account</div></div>';
            
            if (followUpAnswers.hasBalancePenalties === 'yes') {
                html += '<h2>üí∞ Penalty Abatement (Save 25-47%)</h2>';
                html += '<div class="checklist-item"><div class="checkbox"></div><div>Check if you qualify for First-Time Penalty Abatement (clean 3-year history)</div></div>';
                html += '<div class="checklist-item"><div class="checkbox"></div><div>OR gather documentation for Reasonable Cause abatement</div></div>';
                html += '<div class="checklist-item"><div class="checkbox"></div><div>Call IRS at <strong>1-800-829-1040</strong> to request penalty abatement</div></div>';
                html += '<div class="checklist-item"><div class="checkbox"></div><div>OR submit Form 843 by mail with supporting documentation</div></div>';
            }
            
            html += '<h2>üìû Important Contacts</h2>';
            html += '<div class="links">';
            html += '<p><strong>IRS Payments:</strong> www.irs.gov/payments</p>';
            html += '<p><strong>IRS Account:</strong> www.irs.gov/account</p>';
            html += '<p><strong>IRS Phone:</strong> 1-800-829-1040 (Mon-Fri, 7am-7pm local time)</p>';
            html += '<p><strong>Professional Help:</strong> calendly.com/shontathomas/60-min-strategy-call</p>';
            html += '</div>';
            
            html += '<h2>üìö Your Resources</h2>';
            html += '<div class="links">';
            html += '<p><strong>IRS Payment Plan Playbook:</strong><br>https://drive.google.com/file/d/1tdJ9ahA53UEzE__3kYjGeIjC4SV6Cizg/view</p>';
            html += '<p><strong>IRS Notice Decoder:</strong><br>https://drive.google.com/file/d/1UfCAVZRmKe670CZ3BxnAphf2wjPs687N/view</p>';
            html += '<p><strong>Compliance Tracker:</strong><br>https://docs.google.com/spreadsheets/d/1X_bpT6DNsrOjE602ScYUI_-2FGsD11mC/edit</p>';
            html += '</div>';
            
            html += '<div class="footer">';
            html += '<p>Generated by IRS Notice Analyzer | Thomas Tax Strategists</p>';
            html += '<p>This checklist is for reference only and is not legal or tax advice.</p>';
            html += '</div>';
            
            html += '</body></html>';
            
            // Create download
            var blob = new Blob([html], {type: 'text/html'});
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'My-IRS-Action-Plan-' + noticeType + '.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function goToStep(stepNum) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + stepNum).classList.add('active');
            window.scrollTo(0, 0);
        }
    </script>
</body>
</html>
